app:
  description: Clinical Agent for Retrieval & Analysis
  icon: ðŸ’Š
  icon_background: '#D3F8DF'
  mode: advanced-chat
  name: Project CLARA
  use_icon_as_answer_icon: false
dependencies:
- current_identifier: null
  type: marketplace
  value:
    marketplace_plugin_unique_identifier: langgenius/google:0.0.9@d360bbc433f39be1b11909cb9c32e6be4a17ea06af083f9e1c7613bb802bf517
    version: null
- current_identifier: null
  type: marketplace
  value:
    marketplace_plugin_unique_identifier: langgenius/openai_api_compatible:0.0.25@6c02d20ecf7eba40234be5201f25c2b6ea918ec09e0f8eb2a333efb495947d02
    version: null
- current_identifier: null
  type: marketplace
  value:
    marketplace_plugin_unique_identifier: langgenius/gemini:0.6.4@17f286b2d6699a258a2eba8bc1bff71b8f795b6aa7bee1464cbfa450b451303a
    version: null
kind: app
version: 0.4.0
workflow:
  conversation_variables: []
  environment_variables: []
  features:
    file_upload:
      allowed_file_extensions:
      - .JPG
      - .JPEG
      - .PNG
      - .GIF
      - .WEBP
      - .SVG
      allowed_file_types:
      - image
      allowed_file_upload_methods:
      - remote_url
      - local_file
      enabled: true
      fileUploadConfig:
        audio_file_size_limit: 50
        batch_count_limit: 5000
        file_size_limit: 100
        image_file_size_limit: 10
        video_file_size_limit: 100
        workflow_file_upload_limit: 10
      image:
        enabled: false
        number_limits: 3
        transfer_methods:
        - local_file
        - remote_url
      number_limits: 3
    opening_statement: ''
    retriever_resource:
      enabled: true
    sensitive_word_avoidance:
      enabled: false
    speech_to_text:
      enabled: true
    suggested_questions: []
    suggested_questions_after_answer:
      enabled: true
    text_to_speech:
      enabled: true
      language: ''
      voice: ''
  graph:
    edges:
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: template-transform
        targetType: tool
      id: 1760800938976-source-1760799463379-target
      selected: false
      source: '1760800938976'
      sourceHandle: source
      target: '1760799463379'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: tool
        targetType: template-transform
      id: 1760799463379-source-1760803102598-target
      selected: false
      source: '1760799463379'
      sourceHandle: source
      target: '1760803102598'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: template-transform
        targetType: knowledge-retrieval
      id: 1760853855187-source-1711528915811-target
      selected: false
      source: '1760853855187'
      sourceHandle: source
      target: '1711528915811'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: knowledge-retrieval
        targetType: template-transform
      id: 1711528915811-source-1760803102598-target
      selected: false
      source: '1711528915811'
      sourceHandle: source
      target: '1760803102598'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: template-transform
        targetType: knowledge-retrieval
      id: 1760858565608-source-1760858635397-target
      selected: false
      source: '1760858565608'
      sourceHandle: source
      target: '1760858635397'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: knowledge-retrieval
        targetType: template-transform
      id: 1760858635397-source-1760803102598-target
      selected: false
      source: '1760858635397'
      sourceHandle: source
      target: '1760803102598'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: template-transform
        targetType: knowledge-retrieval
      id: 1760867601464-source-1760867619500-target
      selected: false
      source: '1760867601464'
      sourceHandle: source
      target: '1760867619500'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: template-transform
        targetType: knowledge-retrieval
      id: 1760867596268-source-1760867631815-target
      selected: false
      source: '1760867596268'
      sourceHandle: source
      target: '1760867631815'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: knowledge-retrieval
        targetType: template-transform
      id: 1760867631815-source-1760803102598-target
      selected: false
      source: '1760867631815'
      sourceHandle: source
      target: '1760803102598'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: knowledge-retrieval
        targetType: template-transform
      id: 1760867619500-source-1760803102598-target
      selected: false
      source: '1760867619500'
      sourceHandle: source
      target: '1760803102598'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: llm
        targetType: answer
      id: 1711528917469-source-1711528919501-target
      selected: false
      source: '1711528917469'
      sourceHandle: source
      target: '1711528919501'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: template-transform
        targetType: knowledge-retrieval
      id: 1760888349249-source-1760888790336-target
      selected: false
      source: '1760888349249'
      sourceHandle: source
      target: '1760888790336'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: knowledge-retrieval
        targetType: template-transform
      id: 1760888790336-source-1760803102598-target
      selected: false
      source: '1760888790336'
      sourceHandle: source
      target: '1760803102598'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: llm
        targetType: template-transform
      id: 1760939080958-source-1760888349249-target
      selected: false
      source: '1760939080958'
      sourceHandle: source
      target: '1760888349249'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: llm
        targetType: template-transform
      id: 1760939080958-source-1760867601464-target
      selected: false
      source: '1760939080958'
      sourceHandle: source
      target: '1760867601464'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: llm
        targetType: template-transform
      id: 1760939080958-source-1760853855187-target
      selected: false
      source: '1760939080958'
      sourceHandle: source
      target: '1760853855187'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: llm
        targetType: template-transform
      id: 1760939080958-source-1760858565608-target
      selected: false
      source: '1760939080958'
      sourceHandle: source
      target: '1760858565608'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: llm
        targetType: template-transform
      id: 1760939080958-source-1760867596268-target
      selected: false
      source: '1760939080958'
      sourceHandle: source
      target: '1760867596268'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: llm
        targetType: template-transform
      id: 1760939080958-source-1760800938976-target
      selected: false
      source: '1760939080958'
      sourceHandle: source
      target: '1760800938976'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: llm
        targetType: knowledge-retrieval
      id: 1760964906318-source-1760965429499-target
      selected: false
      source: '1760964906318'
      sourceHandle: source
      target: '1760965429499'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: knowledge-retrieval
        targetType: template-transform
      id: 1760965429499-source-1760803102598-target
      selected: false
      source: '1760965429499'
      sourceHandle: source
      target: '1760803102598'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: start
        targetType: llm
      id: 1711528914102-source-1763783065759-target
      source: '1711528914102'
      sourceHandle: source
      target: '1763783065759'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: llm
        targetType: if-else
      id: 1763783065759-source-1763783220129-target
      source: '1763783065759'
      sourceHandle: source
      target: '1763783220129'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: if-else
        targetType: llm
      id: 1763783220129-true-1760939080958-target
      source: '1763783220129'
      sourceHandle: 'true'
      target: '1760939080958'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: if-else
        targetType: llm
      id: 1763783220129-false-1763783564942-target
      source: '1763783220129'
      sourceHandle: 'false'
      target: '1763783564942'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: llm
        targetType: answer
      id: 1763783564942-source-1763783628298-target
      source: '1763783564942'
      sourceHandle: source
      target: '1763783628298'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: llm
        targetType: llm
      id: 1760939080958-source-1760964906318-target
      source: '1760939080958'
      sourceHandle: source
      target: '1760964906318'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: template-transform
        targetType: llm
      id: 1760803102598-source-1711528917469-target
      source: '1760803102598'
      sourceHandle: source
      target: '1711528917469'
      targetHandle: target
      type: custom
      zIndex: 0
    nodes:
    - data:
        desc: ''
        selected: false
        title: Start
        type: start
        variables: []
      height: 51
      id: '1711528914102'
      position:
        x: 30
        y: 1153.5
      positionAbsolute:
        x: 30
        y: 1153.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        dataset_ids:
        - XlAYRtQcd39fJJEjyTPXLknYrtzN+zpC/fHq5E71GyMa5fNynKWSkaMia8AZtD72
        desc: Allows you to query text content related to user questions from the
          Knowledge
        multiple_retrieval_config:
          reranking_enable: true
          reranking_mode: reranking_model
          reranking_model:
            model: Qwen/Qwen3-Reranker-8B
            provider: langgenius/openai_api_compatible/openai_api_compatible
          score_threshold: 0.8
          top_k: 4
        query_variable_selector:
        - '1760853855187'
        - output
        retrieval_mode: multiple
        selected: false
        single_retrieval_config:
          model:
            completion_params:
              frequency_penalty: 0
              max_tokens: 512
              presence_penalty: 0
              temperature: 0
              top_p: 1
            mode: chat
            name: gpt-3.5-turbo
            provider: openai
        title: Knowledge Retrieval
        type: knowledge-retrieval
      dragging: false
      height: 133
      id: '1711528915811'
      position:
        x: 1781
        y: 516.5
      positionAbsolute:
        x: 1781
        y: 516.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        context:
          enabled: true
          variable_selector:
          - '1760803102598'
          - output
        desc: Invoking large language models to answer questions or process natural
          language
        memory:
          query_prompt_template: '{{#sys.query#}}'
          role_prefix:
            assistant: ''
            user: ''
          window:
            enabled: true
            size: 100
        model:
          completion_params: {}
          mode: chat
          name: gemini-3-pro-preview
          provider: langgenius/gemini/google
        prompt_template:
        - id: 27d3cb7f-58ae-4797-8f73-ffeec4cab058
          role: system
          text: "**Vai trÃ²**\nBáº¡n lÃ  **CLARA â€“ Final Scientific Editor**. Tá»« **Context**\
            \ Ä‘Ã£ cáº¥p, hÃ£y **lá»c â†’ cháº¥m Ä‘iá»ƒm â†’ xáº¿p háº¡ng â†’ tá»•ng há»£p** vÃ  xuáº¥t báº£n **BÃO\
            \ CÃO (REPORT)** kÃ¨m **Láº¬P LUáº¬N & CITATION (â‰¤ 8 má»¥c)**. **Chá»‰** dÃ¹ng dá»¯\
            \ liá»‡u trong Context, **khÃ´ng** tÆ° váº¥n y khoa cÃ¡ nhÃ¢n hoÃ¡.\n\n**Query**\n\
            `{{#sys.query#}}`\n\n**Inputs (Context)**\n``\n\n---\n\n## 1) Quy táº¯c\
            \ lá»c & cháº¥m Ä‘iá»ƒm (giáº£m â€œtrÃ n dá»¯ liá»‡uâ€)\n\n**Hard filters (loáº¡i ngay):**\n\
            lá»‡ch chá»§ Ä‘á»/quáº§n thá»ƒ/káº¿t cá»¥c; sai má»‘c thá»i gian; **báº£n trÃ¹ng** (Ä‘á»‹nh danh\
            \ nhÆ° **DOI/PMID/NCT/CUI/RxCUI/ICD-11 URI/openFDA recall_number/FAERS\
            \ id**); **bÃ¡o cÃ¡o khÃ´ng Ä‘áº¡t chuáº©n** bÃ¡o cÃ¡o tÆ°Æ¡ng á»©ng (**PRISMA** cho\
            \ tá»•ng quan; **CONSORT** cho RCT; **STROBE** cho quan sÃ¡t; **STARD** cho\
            \ cháº©n Ä‘oÃ¡n). ([BMJ][1])\n\n**CÃ´ng thá»©c RelevanceScore (0â€“100) cho má»—i\
            \ má»¥c:**\n\n```\nScore = 20Â·DesignPriority + 20Â·OutcomeMatch + 15Â·PopulationMatch\n\
            \        + 15Â·Recency + 10Â·SampleSize + 10Â·SettingRelevance + 10Â·QualityFlag\n\
            ```\n\n* **DesignPriority:** SR/MA cháº¥t lÆ°á»£ng cao = 1.0; RCT = 0.9; quan\
            \ sÃ¡t = 0.6; ca bá»‡nh = 0.3.\n* **QualityFlag (vÃ­ dá»¥ cÃ¡ch cháº¥m):**\n\n\
            \  * RCT â†’ **RoB 2** (High risk = 0.3 â€¦ Low risk = 1.0). ([Risk of Bias][2])\n\
            \  * KhÃ´ng ngáº«u nhiÃªn â†’ **ROBINS-I** (Serious/Critical giáº£m máº¡nh Ä‘iá»ƒm).\
            \ ([Cochrane Methods][3])\n  * Tá»•ng quan/há»‡ thá»‘ng â†’ **AMSTAR 2** (Yáº¿u\
            \ á»Ÿ domain trá»ng yáº¿u â†’ háº¡ máº¡nh). ([amstar.ca][4])\n\n**NgÆ°á»¡ng chá»n Ä‘á»ƒ\
            \ tá»•ng há»£p:**\n\n* **Y vÄƒn (bÃ i bÃ¡o/hÆ°á»›ng dáº«n):** láº¥y **6â€“8** má»¥c Ä‘iá»ƒm\
            \ cao nháº¥t (Score â‰¥ 70).\n* **ClinicalTrials:** â‰¤ **5** báº£n ghi Ä‘áº¡i diá»‡n.\n\
            * **openFDA:** â‰¤ **5** báº£n ghi.\n* **UMLS/RxNorm/ICD-11 (tá»« Ä‘iá»ƒn mÃ£):**\
            \ **chá»‰** giá»¯ má»¥c liÃªn quan trá»±c tiáº¿p cÃ¢u há»i.\n\n**Quy táº¯c Ä‘á»‹nh danh\
            \ trong bÃ¡o cÃ¡o:**\n\n* **Thá»­ nghiá»‡m:** `[NCTxxxxxxxx]`\n* **UMLS:** `[CUI:\
            \ Cxxxxxxx]` + (tuá»³ chá»n) `[SOURCE: CODE]`\n* **RxNorm:** `[RxCUI: xxxxxx]`\
            \ (thÃªm **NDC** náº¿u cÃ³)\n* **ICD-11:** `[ICD-11: code]`\n* **openFDA:**\
            \ `[Recall: D-xxxx-yyyy]` / `[FAERS: safetyreportid]` / `[SPL: spl_set_id]`\n\
            \n---\n\n## 2) Thá»© báº­c **Nguá»“n dá»¯ liá»‡u Viá»‡t Nam** (Æ°u tiÃªn khi cÃ³ trong\
            \ Context)\n\n1. **Cá»¥c Quáº£n lÃ½ KhÃ¡m, chá»¯a bá»‡nh â€“ KCB (kcb.vn)**: chuyÃªn\
            \ má»¥c **â€œHÆ°á»›ng dáº«n cháº©n Ä‘oÃ¡n, Ä‘iá»u trá»‹â€**; Quyáº¿t Ä‘á»‹nh/ThÃ´ng tÆ° Ä‘i kÃ¨m\
            \ file PDF. **Æ¯u tiÃªn cao nháº¥t** khi cÃ¢u há»i liÃªn quan cháº©n Ä‘oÃ¡n/Ä‘iá»u\
            \ trá»‹. ([kcb.vn][5])\n2. **Cá»•ng thÃ´ng tin Bá»™ Y táº¿ (moh.gov.vn)**: há»‡ thá»‘ng\
            \ vÄƒn báº£n BYT, tá»•ng há»£p vÄƒn báº£n quy pháº¡m & quyáº¿t Ä‘á»‹nh. **Æ¯u tiÃªn** khi\
            \ cáº§n cÄƒn cá»© phÃ¡p lÃ½/ban hÃ nh. ([Ministry of Health Vietnam][6])\n3. **Cá»¥c\
            \ Quáº£n lÃ½ DÆ°á»£c â€“ DAV (dav.gov.vn)**: quyáº¿t Ä‘á»‹nh cáº¥p/thu há»“i/GÄKLH thuá»‘c,\
            \ thÃ´ng bÃ¡o dÆ°á»£c; dÃ¹ng cho **an toÃ n thuá»‘c & Ä‘Äƒng kÃ½ lÆ°u hÃ nh**. ([Davao.gov][7])\n\
            4. **DÆ°á»£c thÆ° Quá»‘c gia (duocthuquocgia.vn)**: tra cá»©u chuyÃªn kháº£o/hoáº¡t\
            \ cháº¥t chuáº©n hoÃ¡ cá»§a Viá»‡t Nam (náº¿u Context cÃ³ trÃ­ch xuáº¥t). ([DÆ°á»£c ThÆ°\
            \ Quá»‘c Gia Viá»‡t Nam][8])\n5. **Cá»¥c An toÃ n thá»±c pháº©m â€“ VFA (vfa.gov.vn)**:\
            \ cáº£nh bÃ¡o/thu há»“i sáº£n pháº©m thá»±c pháº©m, bá»• sung gÃ³c **giÃ¡m sÃ¡t** (khÃ´ng\
            \ chá»©ng minh quan há»‡ nhÃ¢n quáº£). ([VFA][9])\n6. **Há»‡ thá»‘ng mÃ£ hoÃ¡ lÃ¢m sÃ ng\
            \ â€“ ICD (icd.kcb.vn)**: tham chiáº¿u Ã¡p dá»¥ng mÃ£ hoÃ¡ trong há»‡ thá»‘ng y táº¿\
            \ VN; náº¿u cáº§n Ä‘á»‘i chiáº¿u, cÃ³ thá»ƒ so sÃ¡nh vá»›i **ICD-11 WHO**. ([ICD Vietnam][10])\n\
            \n> **NguyÃªn táº¯c trÃ¬nh bÃ y:** Náº¿u **VN guideline** mÃ¢u thuáº«n vá»›i y vÄƒn\
            \ quá»‘c táº¿, **Æ°u tiÃªn** khuyáº¿n nghá»‹ **VN**; nÃªu rÃµ khÃ¡c biá»‡t trong pháº§n\
            \ **Synthesis & Interpretation**.\n\n---\n\n## 3) Äá»ŠNH Dáº NG Káº¾T QUáº¢ (tÃ¡ch\
            \ hai pháº§n rÃµ rÃ ng)\n\n### \U0001F535 PHáº¦N I â€” REPORT (cho ngÆ°á»i Ä‘á»c)\n\
            \n\U0001F4DD **YÃªu cáº§u Ä‘á»™ dÃ i:** Pháº§n **REPORT pháº£i dÃ i vÃ  dÃ y thÃ´ng tin\
            \ hÆ¡n CITATIONS**; Æ°á»›c lá»‡ **â‰¥ 4Ã—** sá»‘ tá»« cá»§a pháº§n Citations vÃ  **khÃ´ng**\
            \ ráº£i citation trong thÃ¢n bÃ i.\n\n**Executive Summary (5â€“7 bullet logic,\
            \ diá»…n táº£ dá»… hiá»ƒu):**\n\n* NÃªu **cÃ¢u há»i quyáº¿t Ä‘á»‹nh**.\n* 3â€“5 phÃ¡t hiá»‡n\
            \ **Ä‘á»‹nh lÆ°á»£ng** quan trá»ng (náº¿u Context cÃ³; kÃ¨m Æ°á»›c lÆ°á»£ng/CI/p).\n* **Káº¿t\
            \ luáº­n:** Strong/Weak â€” For/Against (náº¿u Ä‘á»§ báº±ng chá»©ng).\n* **GRADE**\
            \ tá»•ng thá»ƒ: High/Moderate/Low/Very low (theo khung **GRADE/EtD**). ([BMJ][11])\n\
            \n**Methods â€” CÃ¡ch chá»n báº±ng chá»©ng (4â€“6 cÃ¢u, vÄƒn xuÃ´i):**\nMÃ´ táº£ nguá»“n\
            \ trong **Context** (Æ°u tiÃªn VN nhÆ° trÃªn), tiÃªu chÃ­ **Ä‘Æ°a vÃ o/loáº¡i trá»«**,\
            \ khung thá»i gian, **ngÆ°á»¡ng Score** (â‰¥70 â†’ â€œKey Studiesâ€; 50â€“69 â†’ â€œAppendixâ€),\
            \ vÃ  xÃ¡c nháº­n **khÃ´ng sá»­ dá»¥ng** tÃ i liá»‡u **ngoÃ i Context**. Dáº«n chiáº¿u\
            \ chuáº©n bÃ¡o cÃ¡o: **PRISMA/CONSORT/STROBE/STARD** cho tÃ­nh minh báº¡ch (nhÆ°ng\
            \ **khÃ´ng** thÃªm nguá»“n má»›i ngoÃ i Context). ([BMJ][1])\n\n**Key Studies\
            \ Table (â‰¤ 8 dÃ²ng):**\n`NÄƒm | Thiáº¿t káº¿ | Quáº§n thá»ƒ | Can thiá»‡p/PhÆ¡i nhiá»…m\
            \ | Káº¿t cá»¥c chÃ­nh | Æ¯á»›c lÆ°á»£ng (CI, p) | Cháº¥t lÆ°á»£ng (RoB2/ROBINS-I/AMSTAR2)\
            \ | ID (PMID/NCT)`\n(Sá»­ dá»¥ng dá»¯ liá»‡u & ID **cÃ³ sáºµn** trong Context; náº¿u\
            \ thiáº¿u, ghi: **â€œ(ID: khÃ´ng cÃ³ trong Context)â€**.)\n\n**Synthesis & Interpretation\
            \ (â‰¤ 400 tá»«, kiá»ƒu IMRaD rÃºt gá»n):**\nTá»•ng há»£p phÃ¡t hiá»‡n chÃ­nh; lÃ m rÃµ\
            \ tÃ­nh nháº¥t quÃ¡n/khÃ¡c biá»‡t; bÃ n vá» **dá»‹ há»£p** (náº¿u cÃ³); **chá»‰** trÃ¬nh\
            \ bÃ y sá»‘ liá»‡u cÃ³ trong Context; náº¿u thiáº¿u, nÃ³i rÃµ **â€œKhÃ´ng Ä‘á»§ dá»¯ liá»‡u\
            \ trong Contextâ€**; nÃªu **háº¡n cháº¿** áº£nh hÆ°á»Ÿng suy luáº­n.\n\n**Decision\
            \ Block (GRADE + EtD rÃºt gá»n):**\n\n* **Recommendation:** Strong/Weak\
            \ â€” For/Against (chá»‰ khi Ä‘á»§ dá»¯ liá»‡u).\n* **Reasons (bullet ngáº¯n):** lá»£i\
            \ Ã­ch/háº¡i; giÃ¡ trá»‹â€“Æ°u tiÃªn; chi phÃ­â€“nguá»“n lá»±c; kháº£ thi; cÃ´ng báº±ng. (Theo\
            \ **GRADE EtD**). ([BMJ][11])\n\n**Pháº§n chuyÃªn biá»‡t theo intent (chá»‰ Ä‘Æ°a\
            \ nhÃ³m xuáº¥t hiá»‡n trong Context):**\n\n* **ClinicalTrials:** Báº£ng `NCT\
            \ | TiÃªu Ä‘á» | Condition | StudyType | Tráº¡ng thÃ¡i | Quá»‘c gia | Má»‘c (Start/Primary)`\
            \ (â‰¤ 5 dÃ²ng) + **3 nháº­n Ä‘á»‹nh tá»•ng quÃ¡t**.\n* **openFDA:** Báº£ng `recall_number\
            \ | product | reason | class | date | source` (â‰¤ 5 dÃ²ng); nháº¥n máº¡nh: **dá»¯\
            \ liá»‡u giÃ¡m sÃ¡t**, **khÃ´ng kháº³ng Ä‘á»‹nh** quan há»‡ nhÃ¢n quáº£.\n* **ICD-11\
            \ & RxNorm:** `Code â€“ Title â€“ (Definition ngáº¯n náº¿u cÃ³) â€“ URI / TÃªn â†’ RxCUI/NDC`\
            \ (chá»‰ má»¥c **liÃªn quan trá»±c tiáº¿p**).\n* **UMLS:** `CUI â€“ TÃªn khÃ¡i niá»‡m\
            \ â€“ Semantic Types (â‰¤3) â€“ (Äá»‹nh nghÄ©a ngáº¯n/nguá»“n náº¿u cÃ³) â€“ URI`; kÃ¨m `[SOURCE:\
            \ CODE]` khi phÃ¹ há»£p.\n\n**Appendix (tuá»³ chá»n, khÃ´ng tÄƒng sá»‘ citation):**\n\
            Liá»‡t kÃª cÃ¡c má»¥c **Score 50â€“69** Ä‘Ã£ xem xÃ©t nhÆ°ng **khÃ´ng** Ä‘Æ°a vÃ o **Key\
            \ Studies** (1â€“2 dÃ²ng/má»¥c, khÃ´ng thÃªm trÃ­ch dáº«n).\n\n---\n\n### \U0001F7E3\
            \ PHáº¦N II â€” Láº¬P LUáº¬N & CITATION (audit ngáº¯n)\n\n* **Láº­p luáº­n chá»n lá»c\
            \ (â‰¤ 8 bullet):** Táº¡i sao má»—i má»¥c vÃ o **Key Studies**: **Score**, 1 lÃ½\
            \ do **thiáº¿t káº¿/cháº¥t lÆ°á»£ng**, 1 lÃ½ do **phÃ¹ há»£p káº¿t cá»¥c**; náº¿u loáº¡i nghiÃªn\
            \ cá»©u â€œgÃ¢y chÃº Ã½â€, nÃªu **1 cÃ¢u** lÃ½ do (lá»‡ch quáº§n thá»ƒ/káº¿t cá»¥c, RoB cao,\
            \ v.v.).\n* **Citations (â‰¤ 8 má»¥c, kiá»ƒu Vancouver rÃºt gá»n):** **Chá»‰** liá»‡t\
            \ kÃª má»¥c **Ä‘Ã£ dÃ¹ng** trong REPORT; gáº¯n **Ä‘á»‹nh danh báº¯t buá»™c**: `[PMID/NCT/CUI/RxCUI/ICD-11\
            \ URI/Recall/FAERS/SPL]`.\n* **YÃªu cáº§u Ä‘á»™ dÃ i:** Pháº§n **Citations** pháº£i\
            \ **ngáº¯n gá»n**, tá»‘i Ä‘a **Â¼** Ä‘á»™ dÃ i ngÃ´n tá»« cá»§a **REPORT**.\n\n---\n\n\
            ## 4) Quy táº¯c trÃ¬nh bÃ y & an toÃ n\n\n* **NgÃ´n ngá»¯:** tiáº¿ng Viá»‡t, sÃºc tÃ­ch,\
            \ trung láº­p; Æ°u tiÃªn **báº£ng + Ä‘oáº¡n vÄƒn ngáº¯n**.\n* **KhÃ´ng bá»‹a** ID/sá»‘\
            \ liá»‡u; thiáº¿u ID trong Context â†’ ghi **â€œ(ID: khÃ´ng cÃ³ trong Context)â€**.\n\
            * Náº¿u báº±ng chá»©ng **khÃ´ng Ä‘á»§**, nÃªu rÃµ vÃ  **Ä‘á» xuáº¥t bÆ°á»›c tiáº¿p theo** (thiáº¿t\
            \ káº¿/pha/kÃ­ch thÆ°á»›c máº«u/dá»¯ liá»‡u cáº§n bá»• sung).\n* **KhÃ´ng** Ä‘Æ°a **lá»i khuyÃªn\
            \ Ä‘iá»u trá»‹ cÃ¡ nhÃ¢n hoÃ¡**.\n\n**Chuáº©n phÆ°Æ¡ng phÃ¡p tham chiáº¿u (ná»™i bá»™):**\n\
            **PRISMA 2020**, **CONSORT 2010**, **STROBE**, **STARD 2015**, **RoB 2**,\
            \ **ROBINS-I**, **AMSTAR 2**, **GRADE-EtD**. (DÃ¹ng lÃ m **khung Ä‘Ã¡nh giÃ¡**\
            \ chá»© **khÃ´ng** Ä‘á»ƒ kÃ©o thÃªm tÃ i liá»‡u ngoÃ i Context.) ([BMJ][1])\n\n---\n\
            \n## 5) Ghi chÃº váº­n hÃ nh (Ã¡p dá»¥ng vÃ o pipeline hiá»‡n táº¡i)\n\n* **Æ¯u tiÃªn\
            \ nguá»“n VN** trong bÆ°á»›c há»£p nháº¥t báº±ng chá»©ng (Evidence Combiner) khi ná»™i\
            \ dung **cháº©n Ä‘oÃ¡n/Ä‘iá»u trá»‹/quy Ä‘á»‹nh** náº±m trong pháº¡m vi quá»‘c gia; tham\
            \ chiáº¿u **KCB** vÃ  **moh.gov.vn** Ä‘á»ƒ cÄƒn cá»© vÄƒn báº£n ban hÃ nh & ngÃ y hiá»‡u\
            \ lá»±c. ([kcb.vn][5])\n* Vá»›i thuá»‘c: kiá»ƒm tra **DAV** (quyáº¿t Ä‘á»‹nh cáº¥p/thu\
            \ há»“i/GÄKLH), **DÆ°á»£c thÆ° Quá»‘c gia** (chuyÃªn kháº£o), vÃ  khi cÃ³ **cáº£nh bÃ¡o\
            \ an toÃ n thá»±c pháº©m** liÃªn Ä‘á»›i thÃ¬ xem **VFA**. ([Davao.gov][7])\n* Vá»›i\
            \ mÃ£ bá»‡nh & phÃ¢n loáº¡i: náº¿u Context cÃ³ **ICD-11** tá»« WHO vÃ /hoáº·c **icd.kcb.vn**,\
            \ hiá»ƒn thá»‹ **code + tiÃªu Ä‘á» + URI**. ([ICD Online][12])\n\n---\n\nâ€œ**Báº¯t\
            \ buá»™c**: tá»•ng sá»‘ tá»« pháº§n **REPORT** (Executive Summary + Methods + Tables\
            \ + Synthesis + Decision + Pháº§n chuyÃªn biá»‡t + Appendix) **â‰¥ 4 láº§n** tá»•ng\
            \ sá»‘ tá»« pháº§n **Citations**. Náº¿u vi pháº¡m, rÃºt gá»n **Citations** hoáº·c má»Ÿ\
            \ rá»™ng **Synthesis** báº±ng cÃ¡ch giáº£i thÃ­ch **lÃ½ do cháº¥m Ä‘iá»ƒm/chá»n lá»c**\
            \ dá»±a trÃªn Context. Tráº£ lá»i toÃ n bá»™ báº±ng tiáº¿ng Viá»‡t, náº¿u lÃ  tá»« tiáº¿ng Anh\
            \ khÃ´ng cÃ³ nghÄ©a tÆ°Æ¡ng Ä‘Æ°Æ¡ng thÃ¬ giá»¯ nguyÃªn.â€\n\n---\n\n## TÃ i liá»‡u/Chuáº©n\
            \ trÃ­ch dáº«n chÃ­nh trong prompt nÃ y\n* **PRISMA 2020** (checklist, flow\
            \ diagrams). ([PRISMA statement][13])\n* **CONSORT 2010** (bÃ¡o cÃ¡o RCT).\
            \ ([BMJ][14])\n* **STROBE** (quan sÃ¡t). ([STROBE][15])\n* **STARD 2015**\
            \ (cháº©n Ä‘oÃ¡n). ([BMJ Open][16])\n* **RoB 2**, **ROBINS-I** (Ä‘á»™ chá»‡ch).\
            \ ([Risk of Bias][2])\n* **AMSTAR 2** (Ä‘Ã¡nh giÃ¡ tá»•ng quan). ([amstar.ca][4])\n\
            * **GRADE â€” EtD** (khung khuyáº¿n nghá»‹). ([BMJ][11])\n\nNo yapping\nLimit\
            \ prose\nBe concious\nYou are matter of fact, concise, and not conversational."
        - id: 36327492-8402-4968-a127-3f63ccd72a43
          role: user
          text: '{{#context#}}'
        reasoning_format: separated
        retry_config:
          max_retries: 3
          retry_enabled: true
          retry_interval: 1000
        selected: false
        structured_output_enabled: false
        title: LLM
        type: llm
        variables: []
        vision:
          configs:
            detail: high
            variable_selector: []
          enabled: false
      height: 177
      id: '1711528917469'
      position:
        x: 2445
        y: 689.5
      positionAbsolute:
        x: 2445
        y: 689.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        answer: '{{#1711528917469.text#}}'
        desc: ''
        selected: false
        title: Answer
        type: answer
        variables: []
      height: 101
      id: '1711528919501'
      position:
        x: 2777
        y: 689.5
      positionAbsolute:
        x: 2777
        y: 689.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        is_team_authorization: true
        paramSchemas:
        - auto_generate: null
          default: null
          form: llm
          human_description:
            en_US: used for searching
            ja_JP: used for searching
            pt_BR: used for searching
            zh_Hans: ç”¨äºŽæœç´¢ç½‘é¡µå†…å®¹
          label:
            en_US: Query string
            ja_JP: Query string
            pt_BR: Query string
            zh_Hans: æŸ¥è¯¢è¯­å¥
          llm_description: key words for searching
          max: null
          min: null
          name: query
          options: []
          placeholder: null
          precision: null
          required: true
          scope: null
          template: null
          type: string
        - auto_generate: null
          default: null
          form: llm
          human_description:
            en_US: Parameter defines the language to use for the Google search. It's
              a two-letter language code. (e.g., en for English, es for Spanish, or
              fr for French). Head to https://serpapi.com/google-languages for a full
              list of supported Google languages.
            ja_JP: Parameter defines the language to use for the Google search. It's
              a two-letter language code. (e.g., en for English, es for Spanish, or
              fr for French). Head to https://serpapi.com/google-languages for a full
              list of supported Google languages.
            pt_BR: Parameter defines the language to use for the Google search. It's
              a two-letter language code. (e.g., en for English, es for Spanish, or
              fr for French). Head to https://serpapi.com/google-languages for a full
              list of supported Google languages.
            zh_Hans: æ­¤å‚æ•°å®šä¹‰ç”¨äºŽ Google æœç´¢çš„è¯­è¨€ã€‚å®ƒæ˜¯ä¸€ä¸ªä¸¤å­—æ¯çš„è¯­è¨€ä»£ç ã€‚ (ä¾‹å¦‚ï¼Œen ä»£è¡¨è‹±è¯­ï¼Œes ä»£è¡¨è¥¿ç­ç‰™è¯­ï¼Œfr ä»£è¡¨æ³•è¯­)ã€‚è¯·å‰å¾€
              https://serpapi.com/google-languages æŸ¥çœ‹å®Œæ•´çš„æ”¯æŒ Google è¯­è¨€åˆ—è¡¨ã€‚
          label:
            en_US: Language
            ja_JP: Language
            pt_BR: Language
            zh_Hans: è¯­è¨€
          llm_description: Language
          max: null
          min: null
          name: hl
          options: []
          placeholder: null
          precision: null
          required: false
          scope: null
          template: null
          type: string
        - auto_generate: null
          default: null
          form: llm
          human_description:
            en_US: Parameter defines the country to use for the Google search. It's
              a two-letter country code. (e.g., us for the United States, uk for United
              Kingdom, or fr for France). Head to the https://serpapi.com/google-countries
              for a full list of supported Google countries.
            ja_JP: Parameter defines the country to use for the Google search. It's
              a two-letter country code. (e.g., us for the United States, uk for United
              Kingdom, or fr for France). Head to the https://serpapi.com/google-countries
              for a full list of supported Google countries.
            pt_BR: Parameter defines the country to use for the Google search. It's
              a two-letter country code. (e.g., us for the United States, uk for United
              Kingdom, or fr for France). Head to the https://serpapi.com/google-countries
              for a full list of supported Google countries.
            zh_Hans: æ­¤å‚æ•°å®šä¹‰ç”¨äºŽ Google æœç´¢çš„å›½å®¶ã€‚å®ƒæ˜¯ä¸€ä¸ªä¸¤å­—æ¯çš„å›½å®¶ä»£ç ã€‚ (ä¾‹å¦‚ï¼Œus ä»£è¡¨ç¾Žå›½ï¼Œuk ä»£è¡¨è‹±å›½ï¼Œfr ä»£è¡¨æ³•å›½)ã€‚è¯·å‰å¾€
              https://serpapi.com/google-countries æŸ¥çœ‹å®Œæ•´çš„æ”¯æŒ Google å›½å®¶åˆ—è¡¨ã€‚
          label:
            en_US: Country
            ja_JP: Country
            pt_BR: Country
            zh_Hans: å›½å®¶
          llm_description: Country
          max: null
          min: null
          name: gl
          options: []
          placeholder: null
          precision: null
          required: false
          scope: null
          template: null
          type: string
        - auto_generate: null
          default: null
          form: llm
          human_description:
            en_US: Parameter defines from where you want the search to originate.
              If several locations match the location requested, we'll pick the most
              popular one. Head to the /locations.json API if you need more precise
              control. The location and uule parameters can't be used together. It
              is recommended to specify location at the city level in order to simulate
              a real userâ€™s search. If location is omitted, the search may take on
              the location of the proxy.
            ja_JP: Parameter defines from where you want the search to originate.
              If several locations match the location requested, we'll pick the most
              popular one. Head to the /locations.json API if you need more precise
              control. The location and uule parameters can't be used together. It
              is recommended to specify location at the city level in order to simulate
              a real userâ€™s search. If location is omitted, the search may take on
              the location of the proxy.
            pt_BR: Parameter defines from where you want the search to originate.
              If several locations match the location requested, we'll pick the most
              popular one. Head to the /locations.json API if you need more precise
              control. The location and uule parameters can't be used together. It
              is recommended to specify location at the city level in order to simulate
              a real userâ€™s search. If location is omitted, the search may take on
              the location of the proxy.
            zh_Hans: æ­¤å‚æ•°å®šä¹‰æœç´¢çš„ä½ç½®ã€‚å¦‚æžœæœ‰å¤šä¸ªä½ç½®ä¸Žè¯·æ±‚çš„ä½ç½®åŒ¹é…ï¼Œæˆ‘ä»¬å°†é€‰æ‹©æœ€å—æ¬¢è¿Žçš„ä¸€ä¸ªã€‚å¦‚æžœéœ€è¦æ›´ç²¾ç¡®çš„æŽ§åˆ¶ï¼Œè¯·å‰å¾€ /locations.json
              APIã€‚location å’Œ uule å‚æ•°ä¸èƒ½åŒæ—¶ä½¿ç”¨ã€‚å»ºè®®åœ¨åŸŽå¸‚çº§åˆ«æŒ‡å®šä½ç½®ï¼Œä»¥æ¨¡æ‹ŸçœŸå®žç”¨æˆ·çš„æœç´¢ã€‚å¦‚æžœçœç•¥ä½ç½®ï¼Œåˆ™æœç´¢å¯èƒ½ä¼šé‡‡ç”¨ä»£ç†çš„ä½ç½®ã€‚
          label:
            en_US: Location
            ja_JP: Location
            pt_BR: Location
            zh_Hans: ä½ç½®
          llm_description: Location
          max: null
          min: null
          name: location
          options: []
          placeholder: null
          precision: null
          required: false
          scope: null
          template: null
          type: string
        params:
          gl: ''
          hl: ''
          location: ''
          query: ''
        provider_id: langgenius/google/google
        provider_name: langgenius/google/google
        provider_type: builtin
        selected: false
        title: GoogleSearch
        tool_configurations: {}
        tool_description: A tool for performing a Google SERP search and extracting
          snippets and webpages.Input should be a search query.
        tool_label: GoogleSearch
        tool_name: google_search
        tool_node_version: '2'
        tool_parameters:
          gl:
            type: mixed
            value: '{{#1760939080958.structured_output.identify.gl_country#}}'
          hl:
            type: mixed
            value: '{{#1760939080958.structured_output.identify.hl_lang#}}'
          location:
            type: mixed
            value: ''
          query:
            type: mixed
            value: '{{#1760939080958.structured_output.identify.search_query#}}'
        type: tool
      height: 51
      id: '1760799463379'
      position:
        x: 1781
        y: 947.5
      positionAbsolute:
        x: 1781
        y: 947.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        selected: false
        template: "{# Build Google query from detected keywords - safe Jinja2 #}\r\
          \n{%- set kws = (detect.keywords | default([], true))[:8] -%}\r\n{%- set\
          \ base = (kws | join(' ')) -%}\r\n{%- set domains = 'site:.gov OR site:.org\
          \ OR site:.edu OR site:who.int' -%}\r\n{{ (base ~ ' ' ~ domains).strip()\
          \ }}\r\n"
        title: Template
        type: template-transform
        variables:
        - value_selector:
          - '1760939080958'
          - structured_output
          - identify
          value_type: object
          variable: detect
      height: 51
      id: '1760800938976'
      position:
        x: 1449
        y: 928.5
      positionAbsolute:
        x: 1449
        y: 928.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        selected: false
        template: "{# =========================\r\n   COMBINED EVIDENCE TEMPLATE (fixed\
          \ NCT)\r\n   Inputs: google, kr, user_query\r\n   =========================\
          \ #}\r\n\r\n# USER QUERY\r\n{{ user_query | default('') }}\r\n\r\n# EVIDENCE\
          \ â€” ClinicalTrials.gov (External KB)\r\n{# --- pick records list from knowledge\
          \ retrieval --- #}\r\n{%- set k = kr -%}\r\n{%- if k is mapping and (k.result\
          \ is defined) -%}\r\n  {%- set k = k.result -%}\r\n{%- endif -%}\r\n\r\n\
          {%- if k is sequence and (k|length) > 0 -%}\r\n  {%- for r in k[:8] -%}\r\
          \n    {# ---- robust link ---- #}\r\n    {%- set link = r.metadata.doc_metadata.path\r\
          \n                  | default(r.metadata.path)\r\n                  | default(r.source)\r\
          \n                  | default(r.url)\r\n                  | default('')\
          \ -%}\r\n\r\n    {# ---- NCT: prefer metadata.doc_metadata.nct_id, then\
          \ metadata.nct_id, else parse from link/content ---- #}\r\n    {%- set nct\
          \ = r.metadata.doc_metadata.nct_id\r\n                | default(r.metadata.nct_id)\r\
          \n                | default('') -%}\r\n    {%- if not nct and link and ('NCT'\
          \ in link) -%}\r\n      {%- set nct = (link.split('/')[-1]) -%}\r\n    {%-\
          \ endif -%}\r\n    {%- if not nct and (r.content | default('')) and ('NCT:'\
          \ in r.content) -%}\r\n      {%- set parts = r.content.split('NCT:') -%}\r\
          \n      {%- if parts|length > 1 -%}\r\n        {%- set nct = (parts[1].split()\
          \ | first) -%}\r\n      {%- endif -%}\r\n    {%- endif -%}\r\n    {%- if\
          \ nct and not nct.startswith('NCT') -%}\r\n      {%- set nct = 'NCT' ~ nct\
          \ -%}\r\n    {%- endif -%}\r\n\r\n    {# ---- status (náº¿u cÃ³) ---- #}\r\n\
          \    {%- set status = r.metadata.doc_metadata.overall_status\r\n       \
          \            | default(r.metadata.overall_status)\r\n                  \
          \ | default('') -%}\r\n\r\nâ€¢ {{ (r.title\r\n      | default(r.metadata.doc_metadata.title)\r\
          \n      | default(r.document_name)\r\n      | default(r.id)\r\n      | default('Untitled'))\
          \ | replace('\\n',' ') }}\r\n  â€” {{ (r.content | default('') | replace('\\\
          n',' '))[:400] ~ ('â€¦' if (r.content|length > 400) else '') }}\r\n  [{% if\
          \ link %}{{ link }}{% endif %}{% if nct %} [{{ nct }}]{% endif %}{% if status\
          \ %} ({{ status }}){% endif %}]\r\n  {%- endfor -%}\r\n{%- else -%}\r\n\
          â€¢ (no clinicaltrials records)\r\n{%- endif -%}\r\n\r\n# EVIDENCE â€” Web Search\r\
          \n{# --- pick object even if 'google' is a list --- #}\r\n{%- set g = google\
          \ -%}\r\n{%- if g is sequence and (g|length) > 0 -%}\r\n  {%- set g = g[0]\
          \ -%}\r\n{%- endif -%}\r\n\r\n{# --- choose items key by provider (SerpAPI\
          \ vs Serper) --- #}\r\n{%- set items = [] -%}\r\n{%- if g.organic_results\
          \ is defined and g.organic_results -%}\r\n  {%- set items = g.organic_results\
          \ -%}\r\n{%- elif g.organic is defined and g.organic -%}\r\n  {%- set items\
          \ = g.organic -%}\r\n{%- endif -%}\r\n\r\n{# --- emit plain text lines for\
          \ LLM context --- #}\r\n{%- if items and (items|length) > 0 -%}\r\n  {%-\
          \ for r in items[:8] -%}\r\nâ€¢ {{ (r.title | default(r.link) | replace('\\\
          n',' ')) }} â€” {{ (r.snippet | default('') | replace('\\n',' ')) }} [{{ r.link\
          \ | default('') }}]\r\n  {%- endfor -%}\r\n{%- else -%}\r\nâ€¢ (no web results)\r\
          \n{%- endif -%}\r\n\r\n# EVIDENCE â€” openFDA\r\n{%- set k = openfda_kr -%}\r\
          \n{%- if k is mapping and (k.result is defined) -%}{% set k = k.result %}{%\
          \ endif -%}\r\n\r\n{%- if k is sequence and (k|length)>0 -%}\r\n  {%- for\
          \ r in k[:8] -%}\r\n    {# metadata (tÃ¹y dataset) #}\r\n    {%- set ds =\
          \ r.metadata.dataset | default(r.metadata.doc_metadata.dataset) | default('')\
          \ -%}\r\n    {%- set recall = r.metadata.recall_number | default('') -%}\r\
          \n    {%- set srs   = r.metadata.safetyreportid | default('') -%}\r\n  \
          \  {%- set spl   = r.metadata.spl_set_id | default('') -%}\r\nâ€¢ {{ r.title\
          \ | default('Untitled') | replace('\\n',' ') }}\r\n  â€” {{ (r.content | default('')\
          \ | replace('\\n',' '))[:400] ~ ('â€¦' if (r.content|length>400) else '')\
          \ }}\r\n  [{{ r.metadata.openfda_api_url | default('') }}]{% if ds %} ({{\
          \ ds }}){% endif %}{% if recall %} [Recall: {{ recall }}]{% endif %}{% if\
          \ srs %} [FAERS: {{ srs }}]{% endif %}{% if spl %} [SPL: {{ spl }}]{% endif\
          \ %}\r\n  {%- endfor -%}\r\n{%- else -%}\r\nâ€¢ (no openFDA records)\r\n{%-\
          \ endif -%}\r\n\r\n# EVIDENCE â€” ICD-11\r\n{%- set k = icd_kr -%}\r\n{%-\
          \ if k is mapping and (k.result is defined) -%}{% set k = k.result %}{%\
          \ endif -%}\r\n\r\n{%- if k is sequence and (k|length) > 0 -%}\r\n  {%-\
          \ for r in k[:8] -%}\r\n    {# ---- láº¥y code / title / uri / definition\
          \ náº¿u cÃ³ ---- #}\r\n    {%- set code  = r.metadata.doc_metadata.code\r\n\
          \                  | default(r.metadata.code)\r\n                  | default('')\
          \ -%}\r\n    {%- set title = r.title\r\n                  | default(r.metadata.doc_metadata.title)\r\
          \n                  | default(r.document_name)\r\n                  | default('Untitled')\
          \ -%}\r\n    {%- set uri   = r.metadata.doc_metadata.uri\r\n           \
          \       | default(r.metadata.path)\r\n                  | default(r.source)\r\
          \n                  | default(r.url)\r\n                  | default('')\
          \ -%}\r\n    {%- set defn  = r.metadata.doc_metadata.definition\r\n    \
          \              | default('') -%}\r\nâ€¢ {{ title | replace('\\n',' ') }}{%\
          \ if code %} [ICD-11: {{ code }}]{% endif %}\r\n  â€” {{ (r.content | default(defn)\
          \ | replace('\\n',' '))[:400] ~ ('â€¦' if ((r.content | default(defn))|length\
          \ > 400) else '') }}\r\n  [{% if uri %}{{ uri }}{% endif %}]\r\n  {%- endfor\
          \ -%}\r\n{%- else -%}\r\nâ€¢ (no ICD-11 records)\r\n{%- endif -%}\r\n\r\n\
          # EVIDENCE â€” RxNorm / RxClass\r\n{%- set k = rxnorm_kr -%}\r\n{%- if k is\
          \ mapping and (k.result is defined) -%}{% set k = k.result %}{% endif -%}\r\
          \n\r\n{%- if k is sequence and (k|length) > 0 -%}\r\n  {%- for r in k[:8]\
          \ -%}\r\n    {%- set dm        = r.metadata.doc_metadata if r.metadata and\
          \ (r.metadata.doc_metadata is defined) else {} -%}\r\n    {%- set rxcui\
          \     = (dm.rxcui | default(r.metadata.rxcui) | default('')) -%}\r\n   \
          \ {%- set ndc       = dm.ndc | default('') -%}\r\n    {%- set classId  \
          \ = dm.classId | default('') -%}\r\n    {%- set className = dm.className\
          \ | default('') -%}\r\n    {%- set classType = dm.classType | default('')\
          \ -%}\r\n    {%- set src       = dm.source_url\r\n                     \
          \ | default(r.metadata.path)\r\n                      | default(r.source)\r\
          \n                      | default(r.url)\r\n                      | default('')\
          \ -%}\r\nâ€¢ {{ (r.title | default('RxNorm record')) | replace('\\n',' ')\
          \ }}\r\n  â€” {{ (r.content | default('') | replace('\\n',' '))[:400] ~ ('â€¦'\
          \ if (r.content|length > 400) else '') }}\r\n  [{% if src %}{{ src }}{%\
          \ endif %}]{% if rxcui %} [RxCUI: {{ rxcui }}]{% endif %}{% if ndc %} [NDC:\
          \ {{ ndc }}]{% endif %}{% if classId %} [Class: {{ classId }}{% if className\
          \ %} ({{ className }}){% endif %}{% if classType %} [{{ classType }}]{%\
          \ endif %}]{% endif %}\r\n  {%- endfor -%}\r\n{%- else -%}\r\nâ€¢ (no RxNorm/RxClass\
          \ records)\r\n{%- endif -%}\r\n\r\n# EVIDENCE â€” UMLS\r\n{%- set k = umls_kr\
          \ -%}\r\n{%- if k is mapping and (k.result is defined) -%}{% set k = k.result\
          \ %}{% endif -%}\r\n\r\n{%- if k is sequence and (k|length) > 0 -%}\r\n\
          \  {%- for r in k[:8] -%}\r\n    {# ---- metadata an toÃ n ---- #}\r\n  \
          \  {%- set md  = r.metadata | default({}) -%}\r\n    {%- set dm  = md.doc_metadata\
          \ if (md is mapping and (md.doc_metadata is defined)) else {} -%}\r\n\r\n\
          \    {# ---- trÆ°á»ng UMLS phá»• biáº¿n ---- #}\r\n    {%- set cui    = dm.cui\
          \ | default(dm.ui) | default('') -%}\r\n    {%- set root   = dm.rootSource\
          \ | default(dm.root_source) | default('') -%}\r\n    {%- set code   = dm.code\
          \ | default('') -%}\r\n    {%- set stys   = dm.semanticTypes | default([])\
          \ -%}\r\n    {%- set defsrc = dm.definitionSource | default('') -%}\r\n\r\
          \n    {# ---- link nguá»“n ---- #}\r\n    {%- set src = dm.path\r\n      \
          \           | default(md.path)\r\n                 | default(r.source)\r\
          \n                 | default(r.url)\r\n                 | default('') -%}\r\
          \n\r\n    {# ---- tiÃªu Ä‘á» fallback ---- #}\r\n    {%- set title = r.title\r\
          \n                  | default(dm.name)\r\n                  | default(r.id)\r\
          \n                  | default('Untitled') -%}\r\n\r\nâ€¢ {{ title | replace('\\\
          n',' ') }}\r\n  â€” {{ (r.content | default('') | replace('\\n',' '))[:400]\
          \ ~ ('â€¦' if (r.content|length > 400) else '') }}\r\n  [{% if src %}{{ src\
          \ }}{% endif %}]\r\n  {%- if cui %} [CUI: {{ cui }}]{% endif -%}\r\n  {%-\
          \ if root and code %} [{{ root }}: {{ code }}]{% elif root and (dm.ui|default(''))\
          \ and (not (cui and (cui|string).startswith('C'))) %} [{{ root }}: {{ dm.ui\
          \ }}]{% endif -%}\r\n  {%- if stys and (stys|length) > 0 %} [STY: {{ (stys|list)[:3]\
          \ | join(', ') }}{% if (stys|length) > 3 %}, â€¦{% endif %}]{% endif -%}\r\
          \n  {%- if defsrc %} [Def: {{ defsrc }}]{% endif %}\r\n  {%- endfor -%}\r\
          \n{%- else -%}\r\nâ€¢ (no UMLS records)\r\n{%- endif -%}\r\n\r\n# EVIDENCE\
          \ â€” Vietnam Guidelines/Docs\r\n{# --- pick records list from Knowledge Retrieval\
          \ (VN) --- #}\r\n{%- set k = vn_kr if vn_kr is defined else kr_vn if kr_vn\
          \ is defined else vn if vn is defined else [] -%}\r\n{%- if k is mapping\
          \ and (k.result is defined) -%}{% set k = k.result %}{% endif -%}\r\n\r\n\
          {%- if k is sequence and (k|length) > 0 -%}\r\n  {%- for r in k[:12] -%}\r\
          \n    {# ---- safe metadata handles ---- #}\r\n    {%- set md  = r.metadata\
          \ | default({}) -%}\r\n    {%- set dm  = md.doc_metadata if (md is mapping\
          \ and (md.doc_metadata is defined)) else {} -%}\r\n\r\n    {# ---- robust\
          \ link (Æ°u tiÃªn source_url/path) ---- #}\r\n    {%- set link = dm.source_url\r\
          \n                  | default(md.source_url)\r\n                  | default(dm.path)\r\
          \n                  | default(md.path)\r\n                  | default(r.source)\r\
          \n                  | default(r.url)\r\n                  | default('')\
          \ -%}\r\n\r\n    {# ---- tiÃªu Ä‘á» Æ°u tiÃªn: document_title/title/document_name\
          \ ---- #}\r\n    {%- set title = r.title\r\n                  | default(dm.document_title)\r\
          \n                  | default(r.document_name)\r\n                  | default(r.id)\r\
          \n                  | default('Untitled') -%}\r\n\r\n    {# ---- phÃ¡p quy:\
          \ quyáº¿t Ä‘á»‹nh/cÃ´ng vÄƒn/thÃ´ng tÆ°â€¦ ---- #}\r\n    {%- set decision = dm.decision_no\r\
          \n                     | default(dm.decision_number)\r\n               \
          \      | default(dm.document_no)\r\n                     | default('') -%}\r\
          \n    {%- set doc_type = dm.type\r\n                     | default(dm.document_type)\r\
          \n                     | default('') -%}\r\n    {%- set issuer   = dm.source_organization\r\
          \n                     | default(dm.organization)\r\n                  \
          \   | default(md.source_organization)\r\n                     | default('')\
          \ -%}\r\n    {%- set issued   = dm.issue_date\r\n                     |\
          \ default(dm.issued_date)\r\n                     | default(dm.date)\r\n\
          \                     | default('') -%}\r\n    {%- set page     = dm.page\r\
          \n                     | default(dm.page_start)\r\n                    \
          \ | default('') -%}\r\n\r\nâ€¢ {{ title | replace('\\n',' ') }}\r\n  â€” {{\
          \ (r.content | default(dm.abstract) | default('') | replace('\\n',' '))[:500]\
          \ ~ ('â€¦' if ((r.content | default(dm.abstract) | default(''))|length > 500)\
          \ else '') }}\r\n  [{% if link %}{{ link }}{% endif %}]\r\n  {%- if decision\
          \ %} [{{ decision }}]{% endif -%}\r\n  {%- if doc_type %} ({{ doc_type }}){%\
          \ endif -%}\r\n  {%- if issuer %} [{{ issuer }}]{% endif -%}\r\n  {%- if\
          \ issued %} [{{ issued }}]{% endif -%}\r\n  {%- if page %} [trang {{ page\
          \ }}]{% endif -%}\r\n  {%- endfor -%}\r\n{%- else -%}\r\nâ€¢ (no Vietnam guideline/official\
          \ records)\r\n{%- endif -%}"
        title: Combined Evidence
        type: template-transform
        variables:
        - value_selector:
          - '1760799463379'
          - json
          value_type: array[object]
          variable: google
        - value_selector:
          - '1711528915811'
          - result
          value_type: array[object]
          variable: kr
        - value_selector:
          - sys
          - query
          value_type: string
          variable: user_query
        - value_selector:
          - '1760858635397'
          - result
          value_type: array[object]
          variable: openfda_kr
        - value_selector:
          - '1760867619500'
          - result
          value_type: array[object]
          variable: icd_kr
        - value_selector:
          - '1760867631815'
          - result
          value_type: array[object]
          variable: rxnorm_kr
        - value_selector:
          - '1760888790336'
          - result
          value_type: array[object]
          variable: umls_kr
        - value_selector:
          - '1760965429499'
          - result
          value_type: array[object]
          variable: vn_kr
      height: 51
      id: '1760803102598'
      position:
        x: 2113
        y: 689.5
      positionAbsolute:
        x: 2113
        y: 689.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        selected: false
        template: "{#-- lÃµi thuáº­t ngá»¯ --#}\r\n{{ so.term }}\r\n{#-- rÃ ng buá»™c thá»i\
          \ gian --#}\r\n{% if so.completion_year %}\r\n AREA[CompletionDate]RANGE[{{so.completion_year}}-01-01,{{so.completion_year}}-12-31]\r\
          \n{% elif so.completion_range and so.completion_range.start_year and so.completion_range.end_year\
          \ %}\r\n AREA[CompletionDate]RANGE[{{so.completion_range.start_year}}-01-01,{{so.completion_range.end_year}}-12-31]\r\
          \n{% endif %}\r\n{#-- tráº¡ng thÃ¡i --#}\r\n{% if so.status and so.status|length>0\
          \ %} status:{{ so.status|join(',') }}{% endif %}"
        title: Build query
        type: template-transform
        variables:
        - value_selector:
          - '1760939080958'
          - structured_output
          - clinicaltrials
          value_type: object
          variable: so
      height: 51
      id: '1760853855187'
      position:
        x: 1449
        y: 538.5
      positionAbsolute:
        x: 1449
        y: 538.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        selected: false
        template: "{%- set so = extract_openfda | default({}) -%}\r\n{%- set dataset\
          \ = so.type | default('drug_enforcement') -%}\r\n{%- set q = so.q | default('')\
          \ -%}\r\n{# Chuá»—i gá»­i cho adapter: \"type:<dataset> <search-expression>\"\
          \ #}\r\ntype:{{ dataset }} {{ q }}\r\n"
        title: Build query
        type: template-transform
        variables:
        - value_selector:
          - '1760939080958'
          - structured_output
          - openfda
          value_type: object
          variable: so
      height: 51
      id: '1760858565608'
      position:
        x: 1449
        y: 689.5
      positionAbsolute:
        x: 1449
        y: 689.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        dataset_ids:
        - cJqqhHn1ho+aIs2NXenlDBu0reoJq+uqqd21Mdz0M8p7n/IkeMY1ZemCtd9mWq9Q
        multiple_retrieval_config:
          reranking_enable: true
          reranking_mode: reranking_model
          reranking_model:
            model: Qwen/Qwen3-Reranker-8B
            provider: langgenius/openai_api_compatible/openai_api_compatible
          score_threshold: 0.8
          top_k: 4
        query_variable_selector:
        - '1760858565608'
        - output
        retrieval_mode: multiple
        selected: false
        title: Knowledge Retrieval 2
        type: knowledge-retrieval
      height: 89
      id: '1760858635397'
      position:
        x: 1781
        y: 689.5
      positionAbsolute:
        x: 1781
        y: 689.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        selected: false
        template: "op:{{ ek.op }}\r\n{%- if ek.name %} name:\"{{ ek.name }}\"{% endif\
          \ -%}\r\n{%- if ek.search %} search:{{ ek.search }}{% endif -%}\r\n{%- if\
          \ ek.ndc %} ndc:{{ ek.ndc }}{% endif -%}\r\n{%- if ek.rxcui %} rxcui:{{\
          \ ek.rxcui }}{% endif -%}\r\n{%- if ek.relaSource %} relaSource:{{ ek.relaSource\
          \ }}{% endif -%}\r\n{%- if ek.relas %} relas:{{ ek.relas }}{% endif -%}"
        title: Build query
        type: template-transform
        variables:
        - value_selector:
          - '1760939080958'
          - structured_output
          - rxnorm
          value_type: object
          variable: ek
      height: 51
      id: '1760867596268'
      position:
        x: 1449
        y: 818.5
      positionAbsolute:
        x: 1449
        y: 818.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        selected: false
        template: '{{ ek.term }}'
        title: Build query
        type: template-transform
        variables:
        - value_selector:
          - '1760939080958'
          - structured_output
          - icd11
          value_type: object
          variable: ek
      height: 51
      id: '1760867601464'
      position:
        x: 1449
        y: 387.5
      positionAbsolute:
        x: 1449
        y: 387.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        dataset_ids:
        - 8RT0x7LEHmIanqFyXU3YwpG5c2uQbgagZY7ND9j6E4KncubIIkE7GmQ4LiSoNoPU
        multiple_retrieval_config:
          reranking_enable: true
          reranking_mode: reranking_model
          reranking_model:
            model: Qwen/Qwen3-Reranker-8B
            provider: langgenius/openai_api_compatible/openai_api_compatible
          score_threshold: 0.8
          top_k: 4
        query_variable_selector:
        - '1760867601464'
        - output
        retrieval_mode: multiple
        selected: false
        title: Knowledge Retrieval 3
        type: knowledge-retrieval
      height: 89
      id: '1760867619500'
      position:
        x: 1781
        y: 387.5
      positionAbsolute:
        x: 1781
        y: 387.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        dataset_ids:
        - vMGBlLf1GZls5tFS0O9Telaid2okUS5RZ9TiH7foRMW7dZnf9zV7/vwygKLvRpCa
        multiple_retrieval_config:
          reranking_enable: true
          reranking_mode: reranking_model
          reranking_model:
            model: Qwen/Qwen3-Reranker-8B
            provider: langgenius/openai_api_compatible/openai_api_compatible
          score_threshold: 0.8
          top_k: 4
        query_variable_selector:
        - '1760867596268'
        - output
        retrieval_mode: multiple
        selected: false
        title: Knowledge Retrieval 4
        type: knowledge-retrieval
      height: 89
      id: '1760867631815'
      position:
        x: 1781
        y: 818.5
      positionAbsolute:
        x: 1781
        y: 818.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        selected: false
        template: "{# ========= UMLS Build Query (hardened, with fallbacks) =========\
          \ #}\r\n{%- set ek = ek | default({}) -%}\r\n\r\n{# láº¥y tham sá»‘ vá»›i máº·c\
          \ Ä‘á»‹nh an toÃ n #}\r\n{%- set op            = (ek.op | default('search'))\
          \ | string | lower -%}\r\n{%- set limit         = (ek.limit | default(5))\
          \ | int -%}\r\n{%- set sabs          = ek.sabs | default('') -%}\r\n{%-\
          \ set searchType    = ek.searchType | default('words') -%}   {# 'normalizedString'\
          \ chá»‰ cho tiáº¿ng Anh #}\r\n{%- set detail        = ek.detail | default('summary')\
          \ -%}\r\n{%- set cui           = ek.cui | default('') -%}\r\n{%- set source\
          \        = ek.source | default('') -%}\r\n{%- set code          = ek.code\
          \ | default('') -%}\r\n{%- set target_source = ek.target_source | default('')\
          \ -%}\r\n{%- set brief_flag    = (ek.brief if (ek is mapping and (ek.brief\
          \ is defined)) else true) -%}\r\n{%- set brief         = 'true' if brief_flag\
          \ else 'false' -%}\r\n\r\n{# dá»±ng term: ek.term -> ek.search_query -> join(keywords)\
          \ #}\r\n{%- set t0 = ek.term | default('', true) -%}\r\n{%- if not t0 %}{%\
          \ set t0 = ek.search_query | default('', true) %}{% endif -%}\r\n{%- if\
          \ not t0 and (ek.keywords is sequence) %}\r\n  {%- set t0 = (ek.keywords\
          \ | reject('equalto','') | list | join(' ')) -%}\r\n{%- endif -%}\r\n{%-\
          \ set term = (t0 | trim | replace('\"','\\\\\"')) -%}\r\n\r\n{# ráº½ nhÃ¡nh\
          \ theo op #}\r\n{%- if op == 'cui' and cui %}\r\nop:cui cui:{{ cui }} detail:{{\
          \ detail }} limit:{{ limit }} brief:{{ brief }}\r\n{%- elif op == 'crosswalk'\
          \ and source and code %}\r\nop:crosswalk source:{{ source }} code:{{ code\
          \ }}{% if target_source %} target_source:{{ target_source }}{% endif %}\
          \ limit:{{ limit }} brief:{{ brief }}\r\n{%- else %}\r\n{# search máº·c Ä‘á»‹nh;\
          \ thÃªm sabs náº¿u cÃ³; searchType máº·c Ä‘á»‹nh 'words' #}\r\nop:search term:\"\
          {{ term }}\" {% if sabs %}sabs:{{ sabs }} {% endif %}searchType:{{ searchType\
          \ }} limit:{{ limit }} brief:{{ brief }}\r\n{%- endif -%}\r\n{# =========\
          \ /UMLS Build Query ========= #}"
        title: Build query
        type: template-transform
        variables:
        - value_selector:
          - '1760939080958'
          - structured_output
          - umls
          value_type: object
          variable: ek
      height: 51
      id: '1760888349249'
      position:
        x: 1449
        y: 258.5
      positionAbsolute:
        x: 1449
        y: 258.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        dataset_ids:
        - 1VyIxjBR3hsNBjC0dD4LEP9zHsQPphhiT83JBAUVkjUCpjCSL2HCW0L6/6lRdsVs
        multiple_retrieval_config:
          reranking_enable: true
          reranking_mode: reranking_model
          reranking_model:
            model: Qwen/Qwen3-Reranker-8B
            provider: langgenius/openai_api_compatible/openai_api_compatible
          score_threshold: 0.8
          top_k: 4
        query_variable_selector:
        - '1760888349249'
        - output
        retrieval_mode: multiple
        selected: false
        title: Knowledge Retrieval 5
        type: knowledge-retrieval
      height: 89
      id: '1760888790336'
      position:
        x: 1781
        y: 258.5
      positionAbsolute:
        x: 1781
        y: 258.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        context:
          enabled: true
          variable_selector:
          - sys
          - query
        model:
          completion_params: {}
          mode: chat
          name: gemini-3-pro-preview
          provider: langgenius/gemini/google
        prompt_template:
        - id: 159f740b-4410-4fbc-b472-7655c8016852
          role: system
          text: "NHIá»†M Vá»¤\nBáº¡n nháº­n message gá»‘c cá»§a ngÆ°á»i dÃ¹ng trong biáº¿n {{#context#}}\
            \ vÃ  tráº£ vá» Má»˜T JSON duy nháº¥t, gá»“m 6 khá»‘i con:\n- identify: Nháº­n diá»‡n\
            \ ngÃ´n ngá»¯/Ä‘á»‹a lÃ½ + tá»« khÃ³a chung (giá»¯ trÆ°á»ng cÅ©).\n- umls: Tá»« khÃ³a/Ã½\
            \ Ä‘á»‹nh cho UMLS/RxNorm/Clinical (giá»¯ trÆ°á»ng cÅ©).\n- icd11: Chuáº©n bá»‹ truy\
            \ váº¥n ICD-11 (giá»¯ trÆ°á»ng cÅ©).\n- rxnorm: Chá»n phÃ©p truy váº¥n RxNorm (giá»¯\
            \ trÆ°á»ng cÅ©).\n- openfda: Truy váº¥n openFDA (giá»¯ trÆ°á»ng cÅ©).\n- clinicaltrials:\
            \ Tá»« khÃ³a + tham sá»‘ ClinicalTrials.gov v2 (giá»¯ trÆ°á»ng cÅ©).\n\nQUY Táº®C\
            \ CHUNG\n- KHÃ”NG bá»‹a Ä‘á»‹a danh; náº¿u khÃ´ng rÃµ: máº·c Ä‘á»‹nh language=vi, lang_iso6391=vi,\
            \ country=VN.\n- Táº¥t cáº£ chuá»—i pháº£i sáº¡ch kÃ½ tá»± thá»«a (#,!,?,â€¦).\n- KhÃ´ng\
            \ láº·p tá»« khoÃ¡; sáº¯p xáº¿p theo má»©c liÃªn quan caoâ†’tháº¥p.\n- Tráº£ vá» Ä‘Ãºng JSON;\
            \ khÃ´ng thÃªm chÃº thÃ­ch.\n\nRÃ€NG BUá»˜C & Máº¶C Äá»ŠNH THEO Tá»ªNG KHá»I\n\n[1]\
            \ identify (chuáº©n BCP-47, ISO 639-1, ISO 3166-1 alpha-2)\n- language_bcp47:\
            \ tháº» BCP-47 (vÃ­ dá»¥ vi, en-US).\n- lang_iso639_1: mÃ£ 2 kÃ½ tá»± (vi, en).\n\
            - country_iso3166_alpha2: mÃ£ quá»‘c gia 2 kÃ½ tá»± (VN, US).\n- keywords: 3â€“8\
            \ má»¥c, â‰¤3 tá»«/má»¥c, tiáº¿ng anh.\n- search_query: chuá»—i search Google ngáº¯n\
            \ gá»n, Æ°u tiÃªn cá»¥m Ä‘a tá»«; chá»‰ dÃ¹ng dáº¥u ngoáº·c kÃ©p khi cá»¥m tháº­t sá»± cá»‘ Ä‘á»‹nh.\n\
            - gl_country: tham sá»‘ â€œglâ€ = country_iso3166_alpha2 viáº¿t thÆ°á»ng (vd vn).\n\
            - hl_lang: tham sá»‘ â€œhlâ€ = lang_iso639_1 (vd vi).\n- notes: cÃ³ thá»ƒ null.\n\
            \n[2] umls  (táº¥t cáº£ viáº¿t TIáº¾NG ANH)\n- lang_bcp47, lang_iso6391, country_iso2:\
            \ nhÆ° trÃªn (en/vi, US/VN).\n- keywords: 1-3 má»¥c, â‰¤3 tá»«, tiáº¿ng Anh, thÆ°á»ng\
            \ hÃ³a lower-case.\n- search_query: ngáº¯n, sÃºc tÃ­ch.\n- gl_country: 2 kÃ½\
            \ tá»± lower-case.\n- hl_lang: 2 kÃ½ tá»± ISO 639-1.\n- source: 1 trong [\"\
            clinicaltrials\",\"openfda\",\"umls\",\"rxnorm\"] theo Ã½ Ä‘á»‹nh ngÆ°á»i dÃ¹ng.\n\
            - params: tÃ¹y nguá»“n:\n  â€¢ clinicaltrials: status (RECRUITING/COMPLETED/...),\
            \ limit (máº·c Ä‘á»‹nh 5)  \n  â€¢ openfda: dataset (drug_enforcement/drug_event/drug_label),\
            \ limit  \n  â€¢ umls: sabs (vd SNOMEDCT_US, RXNORM), limit  \n  â€¢ rxnorm:\
            \ limit\n\n[3] icd11\n- Náº¿u phÃ¡t hiá»‡n mÃ£ ICD-11 há»£p lá»‡ (chá»¯/sá»‘, cÃ³ thá»ƒ\
            \ cÃ³ dáº¥u cháº¥m; vÃ­ dá»¥ 1A00, CA40.0, MG50.90), chuáº©n hoÃ¡ UPPERCASE, bá» khoáº£ng\
            \ tráº¯ng â†’ dÃ¹ng chÃ­nh mÃ£ lÃ m term.\n- Náº¿u KHÃ”NG cÃ³ mÃ£: trÃ­ch 1 cá»¥m cháº©n\
            \ Ä‘oÃ¡n chÃ­nh (â‰¤5 tá»«), Æ°u tiÃªn chuáº©n hoÃ¡ sang tiáº¿ng Anh y khoa náº¿u cháº¯c\
            \ cháº¯n; náº¿u khÃ´ng, giá»¯ nguyÃªn ngÃ´n ngá»¯ ngÆ°á»i dÃ¹ng. KhÃ´ng chá»©a toÃ¡n tá»­/kÃ½\
            \ tá»± Ä‘áº·c biá»‡t.\n- top_k: máº·c Ä‘á»‹nh 5; náº¿u ngÆ°á»i dÃ¹ng nÃ³i â€œtop N/láº¥y Nâ€\
            \ thÃ¬ dÃ¹ng N (1â€“20).\n\n[4] rxnorm\n- Chá»n \"op\" theo yÃªu cáº§u:\n  â€¢ name_to_rxcui\
            \ (search=0|1|9), field \"name\"  \n  â€¢ ndc_to_rxcui (field \"ndc\") \
            \ \n  â€¢ rxcui_to_ndcs (field \"rxcui\")  \n  â€¢ ndc_status / ndc_properties\
            \ (field \"ndc\")  \n  â€¢ rxclass_by_rxcui (fields rxcui, relaSource=MEDRT|ATC,\
            \ relas=may_treat|has_mechanism|...)  \n- CÃ¡c trÆ°á»ng khÃ´ng dÃ¹ng Ä‘áº·t null.\
            \ top_k máº·c Ä‘á»‹nh 5.\n\n[5] openfda\n- type: má»™t trong [\"drug_enforcement\"\
            ,\"drug_event\",\"drug_label\"].\n- q: BIá»‚U THá»¨C openFDA (khÃ´ng kÃ¨m â€œsearch=â€).\
            \ DÃ¹ng field tháº­t:\n  â€¢ Recalls: classification, reason_for_recall, product_description,\
            \ recalling_firm, recall_initiation_date:[YYYYMMDD+TO+YYYYMMDD]  \n  â€¢\
            \ Adverse events (FAERS): patient.reaction.reactionmeddrapt, patient.drug.medicinalproduct,\
            \ receivedate:[YYYYMMDD+TO+YYYYMMDD], seriousness*  \n  â€¢ Labeling (SPL):\
            \ openfda.brand_name, openfda.generic_name, indications_and_usage, warnings\
            \  \n- time_window (tÃ¹y chá»n): {field, from, to} Ä‘á»ƒ báº¡n tá»± chÃ¨n vÃ o q.\
            \  \n- top_k: 1â€“20 (máº·c Ä‘á»‹nh 5). notes: tÃ¹y chá»n.\n\n[6] clinicaltrials\
            \ (API v2)\n- term: 6â€“10 tá»« khÃ³a tiáº¿ng Anh cÃ´ Ä‘á»ng (khÃ´ng stopwords);\
            \ chá»‰ 2â€“3 cá»¥m chÃ­nh náº¿u ngÆ°á»i dÃ¹ng ráº¥t ngáº¯n gá»n.\n- status: Ã¡nh xáº¡ cá»¥m\
            \ ngÆ°á»i dÃ¹ng sang enum v2 [\"RECRUITING\",\"NOT_YET_RECRUITING\",\"ACTIVE_NOT_RECRUITING\"\
            ,\"ENROLLING_BY_INVITATION\",\"COMPLETED\",\"TERMINATED\",\"SUSPENDED\"\
            ,\"WITHDRAWN\",\"UNKNOWN\"].\n- Náº¿u cÃ³ â€œcompleted in 2024â€ â†’ completion_year=2024;\
            \ cÃ³ khoáº£ng nÄƒm â†’ completion_range {start_year,end_year}.\n- primary_completion:\
            \ true náº¿u ngÆ°á»i dÃ¹ng nháº¯c â€œprimary completionâ€.\n- phase: [\"PHASE_1\"\
            ,\"PHASE_2\",\"PHASE_3\",\"PHASE_4\",\"EARLY_PHASE_1\"] náº¿u Ä‘á» cáº­p.\n\
            - countries: Ä‘iá»n náº¿u ngÆ°á»i dÃ¹ng nÃ³i rÃµ.\n\nNGUYÃŠN Táº®C NGÃ”N NGá»®/QUá»C GIA\n\
            - Æ¯u tiÃªn suy luáº­n tá»« ngá»¯ cáº£nh (tÃªn Ä‘á»‹a danh, Ä‘Æ¡n vá»‹ tiá»n tá»‡, miá»n ccTLD).\
            \ Náº¿u khÃ´ng xÃ¡c Ä‘á»‹nh: vi/VN.\n- BCP-47 há»£p lá»‡ (vÃ­ dá»¥ en-US); ISO 639-1\
            \ lÃ  2 kÃ½ tá»±; ISO 3166-1 alpha-2 lÃ  2 kÃ½ tá»±.\n\nÄáº¦U RA JSON (CHá»ˆ JSON,\
            \ KHÃ”NG MÃ” Táº¢):\n{\n  \"identify\": {\n    \"language_bcp47\": \"...\"\
            ,\n    \"lang_iso639_1\": \"...\",\n    \"country_iso3166_alpha2\": \"\
            ...\",\n    \"keywords\": [\"...\"],\n    \"search_query\": \"...\",\n\
            \    \"gl_country\": \"...\",\n    \"hl_lang\": \"...\",\n    \"notes\"\
            : null\n  },\n  \"umls\": {\n    \"lang_bcp47\": \"...\",\n    \"lang_iso6391\"\
            : \"...\",\n    \"country_iso2\": \"...\",\n    \"keywords\": [\"...\"\
            ],\n    \"search_query\": \"...\",\n    \"gl_country\": \"...\",\n   \
            \ \"hl_lang\": \"...\",\n    \"source\": \"clinicaltrials|openfda|umls|rxnorm\"\
            ,\n    \"params\": {\n      \"status\": \"RECRUITING|COMPLETED|...\",\n\
            \      \"sabs\": \"SNOMEDCT_US|RXNORM|...\",\n      \"dataset\": \"drug_enforcement|drug_event|drug_label\"\
            ,\n      \"limit\": 5\n    }\n  },\n  \"icd11\": {\n    \"term\": \"...\"\
            ,\n    \"top_k\": 5\n  },\n  \"rxnorm\": {\n    \"op\": \"name_to_rxcui|ndc_to_rxcui|rxcui_to_ndcs|ndc_status|ndc_properties|drugs_by_name|rxclass_by_rxcui\"\
            ,\n    \"name\": null,\n    \"ndc\": null,\n    \"rxcui\": null,\n   \
            \ \"relaSource\": null,\n    \"relas\": null,\n    \"search\": null,\n\
            \    \"top_k\": 5\n  },\n  \"openfda\": {\n    \"type\": \"drug_enforcement|drug_event|drug_label\"\
            ,\n    \"q\": \"...\",\n    \"time_window\": {\n      \"field\": \"recall_initiation_date|receivedate|effective_time\"\
            ,\n      \"from\": \"YYYYMMDD\",\n      \"to\": \"YYYYMMDD\"\n    },\n\
            \    \"top_k\": 5,\n    \"notes\": \"\"\n  },\n  \"clinicaltrials\": {\n\
            \    \"term\": \"...\",\n    \"status\": [\"RECRUITING\",\"COMPLETED\"\
            ],\n    \"completion_year\": 2024,\n    \"completion_range\": { \"start_year\"\
            : 2019, \"end_year\": 2024 },\n    \"primary_completion\": false,\n  \
            \  \"phase\": [\"PHASE_3\"],\n    \"countries\": [\"United States\",\"\
            Vietnam\"]\n  }\n}\n\nLUÃ”N NHá»š: Táº¤T Cáº¢ KEYWORDS Báº°NG TIáº¾NG ANH"
        - id: 9619eec7-b2fb-4041-8adb-52a17af17e6f
          role: user
          text: '{{#sys.query#}}

            {{#context#}}'
        reasoning_format: tagged
        retry_config:
          max_retries: 3
          retry_enabled: true
          retry_interval: 1000
        selected: false
        structured_output:
          schema:
            additionalProperties: false
            properties:
              clinicaltrials:
                additionalProperties: false
                properties:
                  completion_range:
                    additionalProperties: false
                    properties:
                      end_year:
                        type: integer
                      start_year:
                        type: integer
                    type: object
                  completion_year:
                    maximum: 2100
                    minimum: 1990
                    type: integer
                  countries:
                    items:
                      type: string
                    type: array
                  phase:
                    items:
                      enum:
                      - PHASE_1
                      - PHASE_2
                      - PHASE_3
                      - PHASE_4
                      - EARLY_PHASE_1
                      type: string
                    type: array
                  primary_completion:
                    type: boolean
                  status:
                    items:
                      enum:
                      - RECRUITING
                      - NOT_YET_RECRUITING
                      - ACTIVE_NOT_RECRUITING
                      - ENROLLING_BY_INVITATION
                      - COMPLETED
                      - TERMINATED
                      - SUSPENDED
                      - WITHDRAWN
                      - UNKNOWN
                      type: string
                    type: array
                  term:
                    type: string
                required:
                - term
                type: object
              icd11:
                properties:
                  term:
                    type: string
                  top_k:
                    default: 5
                    type: integer
                required:
                - term
                type: object
              identify:
                properties:
                  country_iso3166_alpha2:
                    type: string
                  gl_country:
                    type: string
                  hl_lang:
                    type: string
                  keywords:
                    items:
                      type: string
                    maxItems: 8
                    minItems: 3
                    type: array
                    uniqueItems: true
                  lang_iso639_1:
                    type: string
                  language_bcp47:
                    type: string
                  notes:
                    type:
                    - string
                    - 'null'
                  search_query:
                    type: string
                required:
                - language_bcp47
                - lang_iso639_1
                - country_iso3166_alpha2
                - keywords
                - search_query
                - gl_country
                - hl_lang
                type: object
              openfda:
                properties:
                  notes:
                    type: string
                  q:
                    type: string
                  time_window:
                    properties:
                      field:
                        type: string
                      from:
                        pattern: ^[0-9]{8}$
                        type: string
                      to:
                        pattern: ^[0-9]{8}$
                        type: string
                    type: object
                  top_k:
                    default: 5
                    maximum: 20
                    minimum: 1
                    type: integer
                  type:
                    enum:
                    - drug_enforcement
                    - drug_event
                    - drug_label
                    type: string
                required:
                - type
                - q
                type: object
              rxnorm:
                properties:
                  name:
                    type:
                    - string
                    - 'null'
                  ndc:
                    type:
                    - string
                    - 'null'
                  op:
                    enum:
                    - name_to_rxcui
                    - ndc_to_rxcui
                    - rxcui_to_ndcs
                    - ndc_status
                    - ndc_properties
                    - drugs_by_name
                    - rxclass_by_rxcui
                    type: string
                  relaSource:
                    type:
                    - string
                    - 'null'
                  relas:
                    type:
                    - string
                    - 'null'
                  rxcui:
                    type:
                    - string
                    - 'null'
                  search:
                    type:
                    - string
                    - 'null'
                  top_k:
                    default: 5
                    type: integer
                required:
                - op
                type: object
              umls:
                properties:
                  country_iso2:
                    type: string
                  gl_country:
                    type: string
                  hl_lang:
                    type: string
                  keywords:
                    items:
                      type: string
                    maxItems: 8
                    minItems: 3
                    type: array
                  lang_bcp47:
                    type: string
                  lang_iso6391:
                    type: string
                  params:
                    properties:
                      dataset:
                        type: string
                      limit:
                        default: 5
                        type: integer
                      sabs:
                        type: string
                      status:
                        type: string
                    type: object
                  search_query:
                    type: string
                  source:
                    enum:
                    - clinicaltrials
                    - openfda
                    - umls
                    - rxnorm
                    type: string
                required:
                - lang_bcp47
                - lang_iso6391
                - country_iso2
                - keywords
                - search_query
                - gl_country
                - hl_lang
                - source
                - params
                type: object
            required:
            - identify
            - umls
            - icd11
            - rxnorm
            - openfda
            - clinicaltrials
            type: object
        structured_output_enabled: true
        title: Single Extractor & Router
        type: llm
        vision:
          enabled: false
      height: 117
      id: '1760939080958'
      position:
        x: 1117
        y: 258.5
      positionAbsolute:
        x: 1117
        y: 258.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        context:
          enabled: true
          variable_selector:
          - '1760939080958'
          - structured_output
          - identify
          - keywords
        model:
          completion_params: {}
          mode: chat
          name: gemini-3-pro-preview
          provider: langgenius/gemini/google
        prompt_template:
        - id: 273a7f49-d95a-4e6a-abb6-0fd3e1e0494e
          role: system
          text: "Role & Goal\nBáº¡n lÃ  bá»™ dá»‹ch vÃ  chuáº©n hoÃ¡ thuáº­t ngá»¯ y khoa cho tá»«.\
            \ Nháº­n Ä‘áº§u vÃ o lÃ  danh sÃ¡ch keywords tiáº¿ng Anh (cÃ³ thá»ƒ gá»“m bá»‡nh, thuá»‘c,\
            \ thá»§ thuáº­t, xÃ©t nghiá»‡m, há»™i chá»©ng, viáº¿t táº¯t). Tráº£ vá» tá»« khoÃ¡ tiáº¿ng Viá»‡t\
            \ tÆ°Æ¡ng á»©ng Ä‘á»ƒ truy váº¥n kho tri thá»©c y táº¿ Viá»‡t Nam, kÃ¨m Ã¡nh xáº¡ khÃ¡i niá»‡m\
            \ (náº¿u cÃ³).\nQuy táº¯c báº¯t buá»™c\nDá»‹ch sang tiáº¿ng Viá»‡t chuáº©n chuyÃªn mÃ´n (vi-VN),\
            \ giá»¯ Ä‘Ãºng dáº¥u; khÃ´ng viáº¿t vÄƒn, chá»‰ tráº£ JSON theo schema cung cáº¥p.\nGiá»¯\
            \ nguyÃªn cÃ¡c chá»¯ viáº¿t táº¯t/Ä‘á»‹nh danh (vÃ­ dá»¥: COPD, ARDS, ICU, NCT, PMID,\
            \ RxCUI, ICD-11 URI); bá»• sung mÃ´ táº£ tiáº¿ng Viá»‡t cho viáº¿t táº¯t.\nVá»›i thuá»‘c,\
            \ Æ°u tiÃªn tÃªn gá»‘c (INN); thÃªm biá»‡t dÆ°á»£c phá»• biáº¿n (náº¿u cáº§n). Vá»›i bá»‡nh/khÃ¡i\
            \ niá»‡m, táº¡o danh sÃ¡ch Ä‘á»“ng nghÄ©a theo thá»±c hÃ nh tra cá»©u (vÃ­ dá»¥: â€œtÄƒng\
            \ huyáº¿t Ã¡pâ€ â‰ˆ â€œcao huyáº¿t Ã¡pâ€).\nChuáº©n hoÃ¡ vÃ  (náº¿u cÃ³) gá»£i Ã½ mÃ£ hoÃ¡: UMLS\
            \ CUI, MeSH Descriptor/Entry terms, RxCUI, ICD-11 URI.\nLoáº¡i trÃ¹ng; tá»‘i\
            \ Ä‘a 50 má»¥c.\nSinh thÃªm biáº¿n thá»ƒ folded (khÃ´ng dáº¥u, lower-case) Ä‘á»ƒ chá»‘ng\
            \ lá»—i gÃµ/khÃ´ng dáº¥u.\nThÃªm má»™t chuá»—i search_query_vi (gá»£i Ã½ Boolean) káº¿t\
            \ há»£p cÃ¡c tá»« khoÃ¡ VN cho bÆ°á»›c Knowledge Retrieval (vÃ­ dá»¥ dÃ¹ng OR, cá»¥m\
            \ trÃ­ch dáº«n \"...\").\nÄiá»n confidence (0â€“1) cho tá»«ng Ã¡nh xáº¡; náº¿u khÃ´ng\
            \ cháº¯c, Ä‘Æ°a vÃ o uncertain vá»›i lÃ½ do ngáº¯n.\nÄáº§u ra: Tráº£ duy nháº¥t má»™t JSON\
            \ theo JSON Schema dÆ°á»›i Ä‘Ã¢y (khÃ´ng thÃªm lá»i giáº£i thÃ­ch).\n\n{\n  \"type\"\
            : \"object\",\n  \"additionalProperties\": false,\n  \"required\": [\"\
            source_language\", \"target_language\", \"terms\", \"search_query_vi\"\
            ],\n  \"properties\": {\n    \"source_language\": {\n      \"type\": \"\
            string\",\n      \"enum\": [\"en\", \"en-US\", \"en-GB\"],\n      \"description\"\
            : \"NgÃ´n ngá»¯ Ä‘áº§u vÃ o.\"\n    },\n    \"target_language\": {\n      \"\
            type\": \"string\",\n      \"const\": \"vi-VN\",\n      \"description\"\
            : \"NgÃ´n ngá»¯ Ä‘Ã­ch.\"\n    },\n    \"terms\": {\n      \"type\": \"array\"\
            ,\n      \"description\": \"Danh sÃ¡ch thuáº­t ngá»¯ Ä‘Ã£ dá»‹ch/chuáº©n hoÃ¡.\",\n\
            \      \"items\": {\n        \"type\": \"object\",\n        \"additionalProperties\"\
            : false,\n        \"required\": [\"source\", \"vi\", \"vi_folded\"],\n\
            \        \"properties\": {\n          \"source\": {\n            \"type\"\
            : \"string\",\n            \"description\": \"Tá»« khoÃ¡ tiáº¿ng Anh gá»‘c.\"\
            \n          },\n          \"category\": {\n            \"type\": \"string\"\
            ,\n            \"enum\": [\"disease\", \"drug\", \"procedure\", \"test\"\
            , \"sign_symptom\", \"device\", \"public_health\", \"other\"],\n     \
            \       \"description\": \"NhÃ³m khÃ¡i niá»‡m Æ°á»›c tÃ­nh.\"\n          },\n\
            \          \"vi\": {\n            \"type\": \"array\",\n            \"\
            minItems\": 1,\n            \"uniqueItems\": true,\n            \"items\"\
            : { \"type\": \"string\" },\n            \"description\": \"CÃ¡c biáº¿n thá»ƒ\
            \ tiáº¿ng Viá»‡t chuáº©n (cÃ³ dáº¥u), Ä‘Ã£ loáº¡i trÃ¹ng.\"\n          },\n        \
            \  \"vi_folded\": {\n            \"type\": \"array\",\n            \"\
            minItems\": 1,\n            \"uniqueItems\": true,\n            \"items\"\
            : { \"type\": \"string\" },\n            \"description\": \"Biáº¿n thá»ƒ khÃ´ng\
            \ dáº¥u (lower-case) dÃ¹ng cho tÃ¬m kiáº¿m tolerant.\"\n          },\n     \
            \     \"abbreviations\": {\n            \"type\": \"array\",\n       \
            \     \"items\": { \"type\": \"string\" },\n            \"description\"\
            : \"Viáº¿t táº¯t giá»¯ nguyÃªn (náº¿u cÃ³).\"\n          },\n          \"mesh\"\
            : {\n            \"type\": \"object\",\n            \"additionalProperties\"\
            : false,\n            \"properties\": {\n              \"descriptor\"\
            : { \"type\": \"string\", \"description\": \"MeSH descriptor (náº¿u cÃ³).\"\
            \ },\n              \"entry_terms\": {\n                \"type\": \"array\"\
            ,\n                \"items\": { \"type\": \"string\" },\n            \
            \    \"description\": \"Tá»« vÃ o (entry terms)/Ä‘á»“ng nghÄ©a liÃªn quan.\"\n\
            \              }\n            }\n          },\n          \"umls\": {\n\
            \            \"type\": \"object\",\n            \"additionalProperties\"\
            : false,\n            \"properties\": {\n              \"cui\": { \"type\"\
            : \"string\", \"pattern\": \"^C\\\\d{7}$\", \"description\": \"UMLS Concept\
            \ Unique Identifier náº¿u cÃ³.\" },\n              \"synonyms_en\": {\n \
            \               \"type\": \"array\",\n                \"items\": { \"\
            type\": \"string\" },\n                \"description\": \"Äá»“ng nghÄ©a tiáº¿ng\
            \ Anh (tá»« UMLS/khÃ¡c) Ä‘á»ƒ Ä‘á»‘i chiáº¿u.\"\n              }\n            }\n\
            \          },\n          \"rxnorm\": {\n            \"type\": \"object\"\
            ,\n            \"additionalProperties\": false,\n            \"properties\"\
            : {\n              \"rxcui\": { \"type\": \"string\", \"description\"\
            : \"RxCUI náº¿u lÃ  thuá»‘c.\" },\n              \"generic\": { \"type\": \"\
            string\", \"description\": \"TÃªn gá»‘c/INN (náº¿u cÃ³).\" },\n            \
            \  \"brands\": {\n                \"type\": \"array\",\n             \
            \   \"items\": { \"type\": \"string\" },\n                \"description\"\
            : \"Biá»‡t dÆ°á»£c liÃªn quan (tuá»³ chá»n).\"\n              }\n            }\n\
            \          },\n          \"icd11\": {\n            \"type\": \"object\"\
            ,\n            \"additionalProperties\": false,\n            \"properties\"\
            : {\n              \"uri\": { \"type\": \"string\", \"description\": \"\
            ICD-11 entity URI (náº¿u biáº¿t).\" },\n              \"code\": { \"type\"\
            : \"string\", \"description\": \"MÃ£ tuyáº¿n tÃ­nh (náº¿u cÃ³).\" }\n       \
            \     }\n          },\n          \"confidence\": {\n            \"type\"\
            : \"number\",\n            \"minimum\": 0,\n            \"maximum\": 1,\n\
            \            \"description\": \"Äá»™ tin cáº­y cá»§a Ã¡nh xáº¡/biÃªn dá»‹ch.\"\n \
            \         },\n          \"notes\": {\n            \"type\": \"string\"\
            ,\n            \"description\": \"Ghi chÃº ngáº¯n vá» lá»±a chá»n dá»‹ch/chuáº©n\
            \ hoÃ¡.\"\n          }\n        }\n      }\n    },\n    \"search_query_vi\"\
            : {\n      \"type\": \"string\",\n      \"description\": \"CÃ¢u truy váº¥n\
            \ Boolean tiáº¿ng Viá»‡t gá»£i Ã½ cho Knowledge Retrieval (dÃ¹ng OR/\\\"...\\\"\
            ).\"\n    },\n    \"uncertain\": {\n      \"type\": \"array\",\n     \
            \ \"description\": \"CÃ¡c má»¥c khÃ´ng cháº¯c cháº¯n cáº§n xÃ¡c nháº­n.\",\n      \"\
            items\": {\n        \"type\": \"object\",\n        \"required\": [\"source\"\
            , \"reason\"],\n        \"properties\": {\n          \"source\": { \"\
            type\": \"string\" },\n          \"reason\": { \"type\": \"string\" }\n\
            \        },\n        \"additionalProperties\": false\n      }\n    }\n\
            \  }\n}\n"
        - id: ae8c4f84-96bb-4b0e-b685-517f94b84e74
          role: user
          text: '{{#context#}}'
        selected: false
        structured_output:
          schema:
            additionalProperties: false
            properties:
              search_query_vi:
                description: CÃ¢u truy váº¥n Boolean tiáº¿ng Viá»‡t gá»£i Ã½ cho Knowledge Retrieval
                  (dÃ¹ng OR/"...").
                type: string
              source_language:
                description: NgÃ´n ngá»¯ Ä‘áº§u vÃ o.
                enum:
                - en
                - en-US
                - en-GB
                type: string
              target_language:
                const: vi-VN
                description: NgÃ´n ngá»¯ Ä‘Ã­ch.
                type: string
              terms:
                description: Danh sÃ¡ch thuáº­t ngá»¯ Ä‘Ã£ dá»‹ch/chuáº©n hoÃ¡.
                items:
                  additionalProperties: false
                  properties:
                    abbreviations:
                      description: Viáº¿t táº¯t giá»¯ nguyÃªn (náº¿u cÃ³).
                      items:
                        type: string
                      type: array
                    category:
                      description: NhÃ³m khÃ¡i niá»‡m Æ°á»›c tÃ­nh.
                      enum:
                      - disease
                      - drug
                      - procedure
                      - test
                      - sign_symptom
                      - device
                      - public_health
                      - other
                      type: string
                    confidence:
                      description: Äá»™ tin cáº­y cá»§a Ã¡nh xáº¡/biÃªn dá»‹ch.
                      maximum: 1
                      minimum: 0
                      type: number
                    icd11:
                      additionalProperties: false
                      properties:
                        code:
                          description: MÃ£ tuyáº¿n tÃ­nh (náº¿u cÃ³).
                          type: string
                        uri:
                          description: ICD-11 entity URI (náº¿u biáº¿t).
                          type: string
                      type: object
                    mesh:
                      additionalProperties: false
                      properties:
                        descriptor:
                          description: MeSH descriptor (náº¿u cÃ³).
                          type: string
                        entry_terms:
                          description: Tá»« vÃ o (entry terms)/Ä‘á»“ng nghÄ©a liÃªn quan.
                          items:
                            type: string
                          type: array
                      type: object
                    notes:
                      description: Ghi chÃº ngáº¯n vá» lá»±a chá»n dá»‹ch/chuáº©n hoÃ¡.
                      type: string
                    rxnorm:
                      additionalProperties: false
                      properties:
                        brands:
                          description: Biá»‡t dÆ°á»£c liÃªn quan (tuá»³ chá»n).
                          items:
                            type: string
                          type: array
                        generic:
                          description: TÃªn gá»‘c/INN (náº¿u cÃ³).
                          type: string
                        rxcui:
                          description: RxCUI náº¿u lÃ  thuá»‘c.
                          type: string
                      type: object
                    source:
                      description: Tá»« khoÃ¡ tiáº¿ng Anh gá»‘c.
                      type: string
                    umls:
                      additionalProperties: false
                      properties:
                        cui:
                          description: UMLS Concept Unique Identifier náº¿u cÃ³.
                          pattern: ^C\d{7}$
                          type: string
                        synonyms_en:
                          description: Äá»“ng nghÄ©a tiáº¿ng Anh (tá»« UMLS/khÃ¡c) Ä‘á»ƒ Ä‘á»‘i
                            chiáº¿u.
                          items:
                            type: string
                          type: array
                      type: object
                    vi:
                      description: CÃ¡c biáº¿n thá»ƒ tiáº¿ng Viá»‡t chuáº©n (cÃ³ dáº¥u), Ä‘Ã£ loáº¡i
                        trÃ¹ng.
                      items:
                        type: string
                      minItems: 1
                      type: array
                      uniqueItems: true
                    vi_folded:
                      description: Biáº¿n thá»ƒ khÃ´ng dáº¥u (lower-case) dÃ¹ng cho tÃ¬m kiáº¿m
                        tolerant.
                      items:
                        type: string
                      minItems: 1
                      type: array
                      uniqueItems: true
                  required:
                  - source
                  - vi
                  - vi_folded
                  type: object
                type: array
              uncertain:
                description: CÃ¡c má»¥c khÃ´ng cháº¯c cháº¯n cáº§n xÃ¡c nháº­n.
                items:
                  additionalProperties: false
                  properties:
                    reason:
                      type: string
                    source:
                      type: string
                  required:
                  - source
                  - reason
                  type: object
                type: array
            required:
            - source_language
            - target_language
            - terms
            - search_query_vi
            type: object
        structured_output_enabled: true
        title: Translate Keywords
        type: llm
        vision:
          enabled: false
      height: 87
      id: '1760964906318'
      position:
        x: 1449
        y: 1020.5
      positionAbsolute:
        x: 1449
        y: 1020.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        dataset_ids:
        - LxLr/dd9jfO/B1w3iyfxup5YFOGrQPoxFKFviGqL+zlqZk6Nq7f1ORzdtYhOUYoT
        multiple_retrieval_config:
          reranking_enable: true
          reranking_mode: reranking_model
          reranking_model:
            model: Qwen/Qwen3-Reranker-8B
            provider: langgenius/openai_api_compatible/openai_api_compatible
          score_threshold: 0.8
          top_k: 4
          weights:
            keyword_setting:
              keyword_weight: 0.3
            vector_setting:
              embedding_model_name: text-embedding-3-large
              embedding_provider_name: langgenius/openai/openai
              vector_weight: 0.7
            weight_type: customized
        query_variable_selector:
        - '1711528914102'
        - sys.query
        retrieval_mode: multiple
        selected: false
        title: Knowledge Retrieval 6
        type: knowledge-retrieval
      height: 89
      id: '1760965429499'
      position:
        x: 1781
        y: 1038.5
      positionAbsolute:
        x: 1781
        y: 1038.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        context:
          enabled: true
          variable_selector:
          - sys
          - query
        model:
          completion_params: {}
          mode: chat
          name: gemini-3-pro-preview
          provider: langgenius/gemini/google
        prompt_template:
        - id: 1cc77c18-e794-4c89-b14f-5c9c99347204
          role: system
          text: '

            báº¡n lÃ  1 chatbot monitoring, dá»±a trÃªn cÃ¢u há»i cá»§a ngÆ°á»i dÃ¹ng: {{#sys.query#}}
            hÃ£y cho biáº¿t Ä‘Ã¢y lÃ  cÃ¢u há»i cÃ³ cáº§n thiáº¿t pháº£i truy xuáº¥t dá»¯ liá»‡u y táº¿ hay
            khÃ´ng. Náº¿u cÃ³, tráº£ lá»i dÆ°á»›i dáº¡ng JSON.'
        - id: 354ea41d-39d3-4d07-a787-5440a4958d12
          role: user
          text: '{{#context#}}'
        retry_config:
          max_retries: 3
          retry_enabled: true
          retry_interval: 1000
        selected: false
        structured_output:
          schema:
            additionalProperties: false
            properties:
              r_decider:
                description: need retriever or not
                enum:
                - 'yes'
                - 'no'
                type: string
            required:
            - r_decider
            type: object
        structured_output_enabled: true
        title: R_DECIDER
        type: llm
        vision:
          enabled: false
      height: 117
      id: '1763783065759'
      position:
        x: 362
        y: 1153.5
      positionAbsolute:
        x: 362
        y: 1153.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        cases:
        - case_id: 'true'
          conditions:
          - comparison_operator: is
            id: cd484810-ad22-42f8-9b93-c4f85267598d
            value: 'yes'
            varType: object
            variable_selector:
            - '1763783065759'
            - structured_output
            - r_decider
          id: 'true'
          logical_operator: and
        selected: false
        title: IF/ELSE 2
        type: if-else
      height: 123
      id: '1763783220129'
      position:
        x: 694
        y: 1153.5
      positionAbsolute:
        x: 694
        y: 1153.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        context:
          enabled: true
          variable_selector:
          - sys
          - query
        model:
          completion_params: {}
          mode: chat
          name: gemini-3-pro-preview
          provider: langgenius/gemini/google
        prompt_template:
        - id: 531113f4-502b-40ff-b553-03cd97250177
          role: system
          text: ' You are CLARA, a helpful and friendly medical assistant. '
        - id: a8f51f71-210e-4260-a847-e9cc7e0b36bc
          role: user
          text: '{{#sys.query#}}

            {{#context#}}'
        selected: false
        title: NORMAL CHAT
        type: llm
        vision:
          enabled: false
      height: 87
      id: '1763783564942'
      position:
        x: 1449
        y: 1155.5
      positionAbsolute:
        x: 1449
        y: 1155.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        answer: '{{#1763783564942.text#}}'
        selected: false
        title: Answer 3
        type: answer
        variables: []
      height: 101
      id: '1763783628298'
      position:
        x: 1781
        y: 1167.5
      positionAbsolute:
        x: 1781
        y: 1167.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    viewport:
      x: -154.0789903432609
      y: -72.063410580165
      zoom: 0.5305007982786394
  rag_pipeline_variables: []
